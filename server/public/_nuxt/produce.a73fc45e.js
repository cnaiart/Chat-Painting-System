import{E as ct}from"./el-page-header.bdddd399.js";import{aJ as De,aN as ze,bI as ut,aq as Ae,au as Me,am as pt,q as B,s as se,W as mt,aa as we,a1 as $,a as I,o as d,h as w,N as _e,k as q,u as t,a9 as be,c as h,w as g,aZ as W,d1 as _t,aC as ft,m as vt,e as c,aD as gt,Q as Y,z as D,t as Z,f as y,bM as yt,E as ht,i as xe,ad as Ke,aH as xt,aI as wt,x as O,H as Ce,b3 as ke,F,r as K,S as X,aG as bt,b as Ve,y as le,B as Ee,O as Ct,Z as kt,X as Vt,C as Se,cM as Te,M as Et,T as Fe,K as ye,br as Bt,cX as $t,Y as It,j as Rt,v as St,p as Tt,l as Ft,cY as Nt}from"./entry.c7e0e7b4.js";import{c as Ne,E as Ht,a as Pt}from"./index.391b7542.js";import"./el-form-item.4ed993c7.js";/* empty css                */import{a as Dt,E as zt}from"./index.ba068d27.js";/* empty css                  *//* empty css               *//* empty css                     *//* empty css                  */import{_ as Q}from"./_plugin-vue_export-helper.c27b6911.js";import{E as At,a as Mt}from"./el-radio-group.78cf17c8.js";import{E as Kt,a as Ot}from"./index.5ddb0503.js";import{u as Oe,_ as Le}from"./index.88b551d2.js";import{_ as Ue}from"./index.vue.3dfb5dc9.js";import{m as Lt,a as Ut,b as qt,c as Wt}from"./chat.bab8475b.js";import{_ as jt}from"./index.vue.d8ead94c.js";import{E as pe}from"./index.ade63ee3.js";import{E as Gt}from"./el-drawer.8c2988a2.js";import{_ as Yt,a as Jt}from"./model-picker.vue.0083d776.js";import"./el-divider.ee6e1291.js";import{u as He}from"./asyncData.f818c9f5.js";import{u as Xt}from"./useLockFn.d62becec.js";import{u as Zt}from"./useCopy.162cbe26.js";import{_ as Qt}from"./create_record_null.544b54e7.js";import{d as eo}from"./index.fa4f9017.js";import{b as to,d as oo}from"./create.05c6a364.js";import{c as he}from"./cloneDeep.c5be0cf1.js";import{f as ao}from"./index.cb3770be.js";import"./_baseClone.69bec34e.js";import"./_getTag.b4ecd864.js";import"./index.aad710b7.js";import"./index.cd5f7601.js";import"./strings.d42ea6f6.js";import"./isEqual.5a66db24.js";import"./debounce.2af106a8.js";import"./_commonjsHelpers.042e6b4d.js";import"./katex.c0798897.js";import"./client-only.97a86643.js";import"./index.222a6e13.js";import"./refs.94480413.js";/* empty css                  */import"./recharge.573a4938.js";const qe=()=>Math.floor(Math.random()*1e4),Pe=l=>typeof pt(l),lo=De({accordion:Boolean,modelValue:{type:ze([Array,String,Number]),default:()=>ut([])}}),so={[Ae]:Pe,[Me]:Pe},We=Symbol("collapseContextKey"),no=(l,s)=>{const a=B(Ne(l.modelValue)),e=n=>{a.value=n;const m=l.accordion?a.value[0]:a.value;s(Ae,m),s(Me,m)},o=n=>{if(l.accordion)e([a.value[0]===n?"":n]);else{const m=[...a.value],_=m.indexOf(n);_>-1?m.splice(_,1):m.push(n),e(m)}};return se(()=>l.modelValue,()=>a.value=Ne(l.modelValue),{deep:!0}),mt(We,{activeNames:a,handleItemClick:o}),{activeNames:a,setActiveNames:e}},ro=()=>{const l=we("collapse");return{rootKls:$(()=>l.b())}},io=I({name:"ElCollapse"}),co=I({...io,props:lo,emits:so,setup(l,{expose:s,emit:a}){const e=l,{activeNames:o,setActiveNames:n}=no(e,a),{rootKls:m}=ro();return s({activeNames:o,setActiveNames:n}),(_,i)=>(d(),w("div",{class:q(t(m)),role:"tablist","aria-multiselectable":"true"},[_e(_.$slots,"default")],2))}});var uo=be(co,[["__file","/home/runner/work/element-plus/element-plus/packages/components/collapse/src/collapse.vue"]]);const po=I({name:"ElCollapseTransition"}),mo=I({...po,setup(l){const s=we("collapse-transition"),a={beforeEnter(e){e.dataset||(e.dataset={}),e.dataset.oldPaddingTop=e.style.paddingTop,e.dataset.oldPaddingBottom=e.style.paddingBottom,e.style.maxHeight=0,e.style.paddingTop=0,e.style.paddingBottom=0},enter(e){e.dataset.oldOverflow=e.style.overflow,e.scrollHeight!==0?(e.style.maxHeight=`${e.scrollHeight}px`,e.style.paddingTop=e.dataset.oldPaddingTop,e.style.paddingBottom=e.dataset.oldPaddingBottom):(e.style.maxHeight=0,e.style.paddingTop=e.dataset.oldPaddingTop,e.style.paddingBottom=e.dataset.oldPaddingBottom),e.style.overflow="hidden"},afterEnter(e){e.style.maxHeight="",e.style.overflow=e.dataset.oldOverflow},beforeLeave(e){e.dataset||(e.dataset={}),e.dataset.oldPaddingTop=e.style.paddingTop,e.dataset.oldPaddingBottom=e.style.paddingBottom,e.dataset.oldOverflow=e.style.overflow,e.style.maxHeight=`${e.scrollHeight}px`,e.style.overflow="hidden"},leave(e){e.scrollHeight!==0&&(e.style.maxHeight=0,e.style.paddingTop=0,e.style.paddingBottom=0)},afterLeave(e){e.style.maxHeight="",e.style.overflow=e.dataset.oldOverflow,e.style.paddingTop=e.dataset.oldPaddingTop,e.style.paddingBottom=e.dataset.oldPaddingBottom}};return(e,o)=>(d(),h(ft,W({name:t(s).b()},_t(a)),{default:g(()=>[_e(e.$slots,"default")]),_:3},16,["name"]))}});var me=be(mo,[["__file","/home/runner/work/element-plus/element-plus/packages/components/collapse-transition/src/collapse-transition.vue"]]);me.install=l=>{l.component(me.name,me)};const _o=me,fo=De({title:{type:String,default:""},name:{type:ze([String,Number]),default:()=>qe()},disabled:Boolean}),vo=l=>{const s=vt(We),a=B(!1),e=B(!1),o=B(qe()),n=$(()=>s==null?void 0:s.activeNames.value.includes(l.name));return{focusing:a,id:o,isActive:n,handleFocus:()=>{setTimeout(()=>{e.value?e.value=!1:a.value=!0},50)},handleHeaderClick:()=>{l.disabled||(s==null||s.handleItemClick(l.name),a.value=!1,e.value=!0)},handleEnterClick:()=>{s==null||s.handleItemClick(l.name)}}},go=(l,{focusing:s,isActive:a,id:e})=>{const o=we("collapse"),n=$(()=>[o.b("item"),o.is("active",t(a)),o.is("disabled",l.disabled)]),m=$(()=>[o.be("item","header"),o.is("active",t(a)),{focusing:t(s)&&!l.disabled}]),_=$(()=>[o.be("item","arrow"),o.is("active",t(a))]),i=$(()=>o.be("item","wrap")),p=$(()=>o.be("item","content")),v=$(()=>o.b(`content-${t(e)}`)),k=$(()=>o.b(`head-${t(e)}`));return{arrowKls:_,headKls:m,rootKls:n,itemWrapperKls:i,itemContentKls:p,scopedContentId:v,scopedHeadId:k}},yo=["aria-expanded","aria-controls","aria-describedby"],ho=["id","tabindex"],xo=["id","aria-hidden","aria-labelledby"],wo=I({name:"ElCollapseItem"}),bo=I({...wo,props:fo,setup(l,{expose:s}){const a=l,{focusing:e,id:o,isActive:n,handleFocus:m,handleHeaderClick:_,handleEnterClick:i}=vo(a),{arrowKls:p,headKls:v,rootKls:k,itemWrapperKls:R,itemContentKls:b,scopedContentId:V,scopedHeadId:z}=go(a,{focusing:e,isActive:n,id:o});return s({isActive:n}),(j,N)=>(d(),w("div",{class:q(t(k))},[c("div",{role:"tab","aria-expanded":t(n),"aria-controls":t(V),"aria-describedby":t(V)},[c("div",{id:t(z),class:q(t(v)),role:"button",tabindex:j.disabled?-1:0,onClick:N[0]||(N[0]=(...P)=>t(_)&&t(_)(...P)),onKeypress:N[1]||(N[1]=gt(Y((...P)=>t(i)&&t(i)(...P),["stop","prevent"]),["space","enter"])),onFocus:N[2]||(N[2]=(...P)=>t(m)&&t(m)(...P)),onBlur:N[3]||(N[3]=P=>e.value=!1)},[_e(j.$slots,"title",{},()=>[D(Z(j.title),1)]),y(t(ht),{class:q(t(p))},{default:g(()=>[y(t(yt))]),_:1},8,["class"])],42,ho)],8,yo),y(t(_o),null,{default:g(()=>[xe(c("div",{id:t(V),class:q(t(R)),role:"tabpanel","aria-hidden":!t(n),"aria-labelledby":t(z)},[c("div",{class:q(t(b))},[_e(j.$slots,"default")],2)],10,xo),[[Ke,t(n)]])]),_:3})],2))}});var je=be(bo,[["__file","/home/runner/work/element-plus/element-plus/packages/components/collapse/src/collapse-item.vue"]]);const Co=xt(uo,{CollapseItem:je}),ko=wt(je),Vo=I({__name:"input",props:{id:{},size:{},disabled:{type:Boolean},modelValue:{},type:{},resize:{},autosize:{},autocomplete:{},formatter:{},parser:{},placeholder:{},form:{},readonly:{type:Boolean},clearable:{type:Boolean},showPassword:{type:Boolean},showWordLimit:{type:Boolean,default:!0},suffixIcon:{},prefixIcon:{},containerRole:{},label:{},tabindex:{},validateEvent:{type:Boolean},inputStyle:{}},emits:["update:modelValue"],setup(l,{emit:s}){const a=l,e=$({get(){return a.modelValue},set(o){s("update:modelValue",o)}});return(o,n)=>{const m=Ce;return d(),h(m,W(a,{modelValue:t(e),"onUpdate:modelValue":n[0]||(n[0]=_=>O(e)?e.value=_:null)}),null,16,["modelValue"])}}}),Eo=I({__name:"textarea",props:{id:{},size:{},disabled:{type:Boolean},modelValue:{},type:{},resize:{},autosize:{},autocomplete:{},formatter:{},parser:{},placeholder:{},form:{},readonly:{type:Boolean},clearable:{type:Boolean},showPassword:{type:Boolean},showWordLimit:{type:Boolean,default:!0},suffixIcon:{},prefixIcon:{},containerRole:{},label:{},tabindex:{},validateEvent:{type:Boolean},inputStyle:{}},emits:["update:modelValue"],setup(l,{emit:s}){const a=l,e=$({get(){return a.modelValue},set(o){s("update:modelValue",o)}});return(o,n)=>{const m=Ce;return d(),h(m,W(a,{modelValue:t(e),"onUpdate:modelValue":n[0]||(n[0]=_=>O(e)?e.value=_:null),type:"textarea",autosize:o.autosize?{minRows:2}:!1}),null,16,["modelValue","autosize"])}}}),Bo=I({__name:"select",props:{defaultValue:{},modelValue:{},options:{default:()=>[]}},emits:["update:modelValue"],setup(l,{emit:s}){const a=l,e=$({get(){return a.modelValue},set(o){s("update:modelValue",o)}});return ke(()=>{a.defaultValue&&(e.value=a.defaultValue)}),(o,n)=>{const m=Dt,_=zt;return d(),h(_,W(o.$attrs,{modelValue:t(e),"onUpdate:modelValue":n[0]||(n[0]=i=>O(e)?e.value=i:null)}),{default:g(()=>[(d(!0),w(F,null,K(o.options,(i,p)=>(d(),h(m,{key:p,label:i,value:i},null,8,["label","value"]))),128))]),_:1},16,["modelValue"])}}});const $o=Q(Bo,[["__scopeId","data-v-bf7a521e"]]);const Io=I({__name:"radio",props:{modelValue:{},options:{},defaultValue:{}},emits:["update:modelValue"],setup(l,{emit:s}){const a=l,e=$({get(){return a.modelValue},set(o){s("update:modelValue",o)}});return ke(()=>{a.defaultValue&&(e.value=a.defaultValue)}),(o,n)=>{const m=At,_=Mt;return d(),h(_,W(o.$attrs,{modelValue:t(e),"onUpdate:modelValue":n[0]||(n[0]=i=>O(e)?e.value=i:null)}),{default:g(()=>[(d(!0),w(F,null,K(o.options,(i,p)=>(d(),h(m,{key:p,label:i,name:i},null,8,["label","name"]))),128))]),_:1},16,["modelValue"])}}});const Ro=Q(Io,[["__scopeId","data-v-231e96fe"]]);const So=I({__name:"checkbox",props:{modelValue:{},options:{},defaultValue:{}},emits:["update:modelValue"],setup(l,{emit:s}){const a=l,e=$({get(){return a.modelValue},set(o){s("update:modelValue",o)}});return ke(()=>{a.defaultValue&&(e.value=a.defaultValue)}),(o,n)=>{const m=Kt,_=Ot;return d(),h(_,W(o.$attrs,{modelValue:t(e),"onUpdate:modelValue":n[0]||(n[0]=i=>O(e)?e.value=i:null)}),{default:g(()=>[(d(!0),w(F,null,K(o.options,(i,p)=>(d(),h(m,{key:p,label:i,name:i},null,8,["label","name"]))),128))]),_:1},16,["modelValue"])}}});const To=Q(So,[["__scopeId","data-v-71662013"]]),Fo=Object.freeze(Object.defineProperty({__proto__:null,WidgetCheckbox:To,WidgetInput:Vo,WidgetRadio:Ro,WidgetSelect:$o,WidgetTextarea:Eo},Symbol.toStringTag,{value:"Module"})),No=I({__name:"index",props:{formLists:{default:()=>[]},modelValue:{},model:{},rules:{},labelPosition:{default:"top"},requireAsteriskPosition:{},labelWidth:{},labelSuffix:{},inline:{type:Boolean},inlineMessage:{type:Boolean},statusIcon:{type:Boolean},showMessage:{type:Boolean},validateOnRuleChange:{type:Boolean},hideRequiredAsterisk:{type:Boolean},scrollToError:{type:Boolean},scrollIntoViewOptions:{},size:{},disabled:{type:Boolean}},emits:["update:modelValue"],setup(l,{expose:s,emit:a}){const e=l,o=X(),n=$({get(){return e.modelValue},set(p){a("update:modelValue",p)}}),m=B({}),_=p=>Fo[p],i=async()=>{var p;await((p=o.value)==null?void 0:p.validate()),console.log(1111)};return se(()=>e.formLists,p=>{m.value=p==null?void 0:p.reduce((v,k)=>(n.value[k.id]=void 0,k.props.isRequired&&(v[k.id]=[{required:!0,message:"必填项不能为空",trigger:"blur"}]),v),{})},{immediate:!0}),s({validate:i}),(p,v)=>{const k=Ht,R=Pt;return d(),h(R,W({ref_key:"formRef",ref:o},e,{rules:t(m),model:t(n),onSubmit:v[0]||(v[0]=Y(()=>{},["prevent"]))}),{default:g(()=>[(d(!0),w(F,null,K(p.formLists,b=>(d(),h(k,{key:b.id,prop:b.id,class:"designer",label:b.props.title},{default:g(()=>[(d(),h(bt(_(b.name)),W(b.props,{modelValue:t(n)[b.id],"onUpdate:modelValue":V=>t(n)[b.id]=V}),null,16,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["prop","label"]))),128))]),_:1},16,["rules","model"])}}});const Ho=Q(No,[["__scopeId","data-v-dc766187"]]),Po={class:"create-record-item"},Do={class:"flex items-center"},zo={class:"mr-auto line-clamp-1 text-lg font-medium"},Ao={class:"flex items-center flex-none mt-[10px]"},Mo={class:"text-xs text-tx-secondary mr-auto"},Ko=I({__name:"record-item",props:{typing:{type:Boolean,default:!1},title:{default:""},time:{default:""},content:{default:""},showCopy:{type:Boolean,default:!0},showRewrite:{type:Boolean,default:!1},overflow:{type:Boolean,default:!1},recordId:{},index:{},showVoice:{type:Boolean,default:!1}},emits:["copy","rewrite","again"],setup(l,{emit:s}){const a=l,e=Ve(),{play:o,audioPlaying:n,pause:m,audioLoading:_}=Oe({api:Lt,dataTransform(i){return i.file_url},params:{records_id:a.recordId,content:a.index,type:1}});return(i,p)=>{var b,V;const v=Le,k=Ue,R=Ee;return d(),w("div",Po,[c("div",Do,[c("div",zo,Z(i.title),1)]),c("div",{class:q(["mt-[10px]",{"line-clamp-[8]":i.overflow}])},[y(v,{content:i.content,loading:i.typing,"use-markdown":!!((V=(b=t(e).config)==null?void 0:b.chat)!=null&&V.is_markdown)},null,8,["content","loading","use-markdown"])],2),c("div",Ao,[c("div",Mo,Z(i.time),1),i.showVoice?(d(),w(F,{key:0},[t(n)?(d(),h(R,{key:0,color:"#F2F2F2",round:"",size:"small",onClick:Y(t(m),["stop"])},{icon:g(()=>[y(k,{name:"local-icon-audio_voice"})]),default:g(()=>[D(" 停止 ")]),_:1},8,["onClick"])):(d(),h(R,{key:1,round:"",size:"small",color:"#F2F2F2",onClick:Y(t(o),["stop"]),loading:t(_)},{icon:g(()=>[y(k,{name:"local-icon-audio_voice"})]),default:g(()=>[D(" 朗读 ")]),_:1},8,["onClick","loading"]))],64)):le("",!0),i.showRewrite?(d(),h(R,{key:1,round:"",size:"small",color:"#F2F2F2",onClick:p[0]||(p[0]=Y(z=>s("again"),["stop"]))},{default:g(()=>[D(" 再来一次 ")]),_:1})):le("",!0),i.showRewrite?(d(),h(R,{key:2,round:"",size:"small",color:"#F2F2F2",onClick:p[1]||(p[1]=Y(z=>s("rewrite"),["stop"]))},{default:g(()=>[D(" 重写 ")]),_:1})):le("",!0),i.showCopy?(d(),h(R,{key:3,round:"",size:"small",color:"#F2F2F2",onClick:p[2]||(p[2]=Y(z=>s("copy",i.content),["stop"]))},{default:g(()=>[D(" 复制 ")]),_:1})):le("",!0)])])}}});const Oo=Q(Ko,[["__scopeId","data-v-875d99b9"]]),Lo={class:"h-full flex flex-col"},Uo={class:"flex items-center pb-[16px]"},qo={class:"text-lg flex-1 min-w-0 font-medium"},Wo=c("span",{class:"ml-[10px]"},"复制",-1),jo={class:"flex-1 min-h-0"},Go={class:"pt-[16px]"},Yo=I({__name:"record-preview",props:{title:{default:""},time:{default:""},content:{default:""},overflow:{type:Boolean,default:!1}},emits:["copy"],setup(l,{expose:s,emit:a}){const e=Ve(),o=B(!1);return s({open:()=>{o.value=!0}}),(m,_)=>{const i=jt,p=Ue,v=Ee,k=Le,R=pe,b=Gt;return d(),h(b,{ref:"drawerRef",modelValue:t(o),"onUpdate:modelValue":_[1]||(_[1]=V=>O(o)?o.value=V:null),title:"创作详情",direction:"rtl",class:"record-preview-drawer",size:"50%","append-to-body":""},{default:g(()=>[c("div",Lo,[c("div",Uo,[c("div",qo,[y(i,{content:m.title},null,8,["content"])]),y(v,{link:"",onClick:_[0]||(_[0]=V=>a("copy",m.content))},{default:g(()=>[y(p,{name:"el-icon-DocumentCopy",size:18}),Wo]),_:1})]),c("div",jo,[y(R,null,{default:g(()=>{var V,z;return[c("div",Go,[y(k,{content:m.content,"use-markdown":!!((z=(V=t(e).config)==null?void 0:V.chat)!=null&&z.is_markdown)},null,8,["content","use-markdown"])])]}),_:1})])])]),_:1},8,["modelValue"])}}});const Jo=(l,s="yyyy-mm-dd")=>{l||(l=Number(new Date)),l.toString().length==10&&(l*=1e3);const a=new Date(l);let e;const o={"y+":a.getFullYear().toString(),"m+":(a.getMonth()+1).toString(),"d+":a.getDate().toString(),"h+":a.getHours().toString(),"M+":a.getMinutes().toString(),"s+":a.getSeconds().toString()};for(const n in o)e=new RegExp("("+n+")").exec(s),e&&(s=s.replace(e[1],e[1].length==1?o[n]:o[n].padStart(e[1].length,"0")));return s},ne=l=>(Tt("data-v-b4c874e6"),l=l(),Ft(),l),Xo={class:"bg-white flex flex-col h-full w-[200px] text-tx-primary"},Zo={class:"pt-[16px] px-[16px]"},Qo={class:"mt-[16px]"},ea={class:"flex justify-end mt-[16px] mb-[10px]"},ta={class:"flex-1 min-h-0"},oa={class:"creation-lists"},aa={class:"px-[16px]"},la=["onClick"],sa=["src"],na={class:"ml-[10px]"},ra={class:"h-full sm:flex"},ia={class:"h-full w-[400px] flex flex-col rounded-[6px] bg-white"},da={class:"flex p-[20px]"},ca={class:"text-lg font-medium line-clamp-1 mr-auto"},ua={class:"flex-1 min-h-0"},pa={class:"p-[20px]"},ma={class:"px-[20px] pb-[20px]"},_a={class:"flex flex-col justify-center items-center"},fa={class:"flex-1 sm:ml-[16px] mt-[16px] sm:mt-0 min-w-0"},va=ne(()=>c("div",{class:"text-lg font-medium mb-[16px]"}," 本次创作结果 ",-1)),ga={class:"overflow-x-hidden"},ya=ne(()=>c("div",{class:"text-lg font-medium mr-[10px]"}," 创作历史 ",-1)),ha={class:"items-stretch"},xa={key:1,class:"h-full flex flex-col items-center justify-center py-[100px]"},wa=ne(()=>c("img",{class:"w-[120px] h-[120px]",src:Qt,alt:""},null,-1)),ba=ne(()=>c("div",{class:"my-[16px] font-medium"}," AI创作结果会在显示这里，现在你只需要 ",-1)),Ca=ne(()=>c("div",{class:"text-tx-regular text-sm"},[D(" 1. 在左侧填好必要的信息，填写越详细，结果越准确哦 "),c("br"),D(" 2.点击立即生成按钮，静待AI妙笔生花，一般在10秒内搞定 ")],-1)),ka=[wa,ba,Ca],Va=I({__name:"produce",async setup(l){let s,a;const e=Ct(),o=B(""),n=kt(),m=X(),_=B(!0),i=B([]),p=B(Number(n.query.id)),v=B({}),k=X(),R=X(),b=B(null),V=Ve(),z=Vt(),j=X(),N=X(),P=Se({title:"",content:""}),re=B(""),{data:fe,pending:Ea,refresh:Ge}=([s,a]=Te(()=>He(()=>to({keyword:o.value}),{default(){return[]}},"$p6CyUgWcnC")),s=await s,a(),s),{pauseAll:Ye}=Oe(),Je=[{name:"WidgetTextarea",title:"多行文本",id:"question",props:{title:"内容描述",placeholder:"",rows:8,maxlength:400,autosize:!1,isRequired:!1}}],Xe=async()=>{await ye.confirm("确定清空创作记录？"),await Ut({type:2,other_id:p.value}),E.value=[],ie()},{data:ee,refresh:Ze}=([s,a]=Te(()=>He(()=>oo({id:p.value}),{default(){return{}},transform(r){return r.form||(r.form=Je),r}},"$x8e8L4FufG")),s=await s,a(),s),x=Se({pageNo:0,count:0,pageSize:15,loading:!0,more:!0,lists:[]}),ve=async()=>{if(x.more||x.pageNo===0)x.pageNo+=1;else return;x.loading=!0;try{const r=await qt({other_id:p.value,page_size:x.pageSize,page_no:x.pageNo,type:2}),{page_no:u,page_size:C,count:H}=r;x.count=H,u*C>H&&(x.more=!1);const T=r.lists.map(S=>{let A="";if(Bt(S.ask)){const U=(S==null?void 0:S.ask[0])||{};A=`${U.title}：${U.value}`}else A=S.ask;return{...S,title:A}});x.pageNo===1&&(x.lists=[]),x.lists.push(...T)}catch(r){console.log("聊天记录错误",r)}finally{x.loading=!1}},ie=()=>{Object.assign(x,{pageNo:0,count:0,pageSize:15}),ve()},Qe=({scrollTop:r})=>{if(x.loading)return;const{clientHeight:u,scrollHeight:C}=b.value.wrapRef;r+u>=C-100&&(console.log("触底了"),ve())},et=(r,u)=>{var C;P.title=r,P.content=u,(C=k.value)==null||C.open()},tt=r=>{p.value=r.id,z.push({path:"",query:{id:r.id}})},Be=r=>{console.log(r),v.value=he(r.extra)},{lockFn:$e}=Xt(async r=>{r.extra&&(v.value=r.extra,await Fe(),Re())});ao(o,r=>{Ge()},{debounce:500});const ot=()=>{var r;(r=ee.value)==null||r.form.forEach(u=>{u.props.placeholder&&!u.props.defaultValue&&(v.value[u.id]=u.props.placeholder)})},at=()=>{var r;(r=ee.value)==null||r.form.forEach(u=>{u.props.defaultValue?v.value[u.id]=he(u.props.defaultValue):v.value[u.id]=void 0})},Ie=()=>{_.value?(_.value=!1,i.value=[]):(i.value=fe.value.map(r=>r.id),_.value=!0)},E=B([]),lt=()=>{var u;if(v.value.question)return v.value.question;const r=((u=ee.value)==null?void 0:u.form[0])||{};return`${r.props.title}：${v.value[r.id]||""}`},L=B(!1);let de=null;const st=()=>{de==null||de.cancel(),L.value=!1},Re=async()=>{var r;try{await((r=m.value)==null?void 0:r.validate())}catch{ye.msgError("必填项不能为空");return}if(e.userInfo.is_chat_limit&&$t(!0,Nt))try{await It.confirm("已超过会员对话上限次数，继续对话将会消耗账户的对话余额","对话上限提示",{showClose:!1,confirmButtonText:"继续",cancelButtonText:"关闭"})}catch{return}if(!L.value)try{L.value=!0;const u=Date.now();Wt({model:re.value,other_id:p.value,question:v.value,type:2},{onstart(C){de=C,E.value.length&&(E.value=[],ie()),Ye()},onmessage(C){C.trim().split("data:").forEach(async H=>{var T;if(H!=="")try{const S=JSON.parse(H),{event:A,data:U,code:ce,index:J}=S;if(A=="error"&&ce===101?(T=j.value)==null||T.open():A=="error"&&ye.msgError(U),A=="chat"){let M=E.value.findIndex(te=>te.id===u);M===-1&&(E.value.push({loading:!0,create_time:Jo(new Date,"yyyy-mm-dd hh:MM:ss"),title:v.value.question?v.value.question:lt(),reply:[],extra:he(v.value),id:u}),M=E.value.length-1),U&&(E.value[M].reply[J]||(E.value[M].reply[J]=""),E.value[M].reply[J]+=U)}if(A==="finish"){const M=E.value.findIndex(te=>te.id===u);E.value[M].loading=!1,E.value[M].reply[J]+=U,at();return}}catch{L.value=!1}})},onclose(){e.getUser(),L.value=!1,x.lists.length<=x.pageSize&&ie()}})}catch{L.value=!1}},{copy:nt}=Zt(),ge=async r=>{await nt(r)};se(fe,r=>{_.value=!1,Ie()},{immediate:!0});const{height:rt}=eo(R);se(rt,r=>{var u,C,H;if(L.value){const T=(C=(u=b.value)==null?void 0:u.wrapRef)==null?void 0:C.offsetHeight,S=r-T;S>0&&((H=b.value)==null||H.setScrollTop(S))}}),se(p,()=>{st(),Ze(),ie(),E.value=[],x.lists=[]});const it=()=>{var T;const[r]=document.getElementsByClassName("creation-item--active");if(!r)return;const u=r.getBoundingClientRect(),C=(T=N.value)==null?void 0:T.wrapRef.getBoundingClientRect(),H=u.top-(C.height/2+C.top);N.value.setScrollTop(H)};return Et(async()=>{await Fe(),it(),ve()}),(r,u)=>{const C=ct,H=Ce,T=Ee,S=ko,A=Co,U=Ho,ce=Oo,J=Yo,M=Jt,te=Rt,dt=St;return d(),h(te,{name:"default"},{panel:g(()=>[c("div",Xo,[c("div",Zo,[y(C,{content:"",onBack:u[0]||(u[0]=f=>r.$router.back())}),c("div",Qo,[y(H,{modelValue:t(o),"onUpdate:modelValue":u[1]||(u[1]=f=>O(o)?o.value=f:null),placeholder:"请输入关键词搜索"},null,8,["modelValue"])]),c("div",ea,[y(T,{link:"",type:"primary",onClick:Ie},{default:g(()=>[D(" 全部"+Z(t(_)?"收起":"展开"),1)]),_:1})])]),c("div",ta,[y(t(pe),{ref_key:"categoryScrollbarRef",ref:N},{default:g(()=>[c("div",oa,[y(A,{modelValue:t(i),"onUpdate:modelValue":u[2]||(u[2]=f=>O(i)?i.value=f:null)},{default:g(()=>[(d(!0),w(F,null,K(t(fe),f=>(d(),h(S,{key:f.id,title:f.name,name:f.id},{default:g(()=>[c("div",aa,[(d(!0),w(F,null,K(f.model,G=>(d(),w("div",{key:G.id,class:q(["creation-item",{"creation-item--active":t(p)==G.id}]),onClick:oe=>tt(G)},[c("img",{class:"w-[28px] h-28px",src:G.image,alt:""},null,8,sa),c("div",na,Z(G.name),1)],10,la))),128))])]),_:2},1032,["title","name"]))),128))]),_:1},8,["modelValue"])])]),_:1},512)])])]),default:g(()=>[c("div",ra,[c("div",ia,[c("div",da,[c("div",ca,Z(t(ee).name),1),y(T,{link:"",type:"primary",onClick:ot},{default:g(()=>[D("插入示例")]),_:1})]),c("div",ua,[y(t(pe),null,{default:g(()=>[c("div",pa,[y(U,{ref_key:"formDesignerRef",ref:m,modelValue:t(v),"onUpdate:modelValue":u[3]||(u[3]=f=>O(v)?v.value=f:null),"form-lists":t(ee).form,size:"large"},null,8,["modelValue","form-lists"])])]),_:1})]),c("div",ma,[y(Yt,{modelValue:t(re),"onUpdate:modelValue":u[4]||(u[4]=f=>O(re)?re.value=f:null)},null,8,["modelValue"]),c("div",_a,[y(T,{class:"create-btn",onClick:Re,loading:t(L)},{default:g(()=>[D(" 立即生成 ")]),_:1},8,["loading"])])])]),xe((d(),w("div",fa,[t(E).length||t(x).lists.length?(d(),h(t(pe),{key:0,ref_key:"scrollbarRef",ref:b,onScroll:Qe},{default:g(()=>[t(E).length?(d(),w("div",{key:0,ref_key:"currentCreationHistoryRef",ref:R},[va,(d(!0),w(F,null,K(t(E),(f,G)=>(d(),w(F,{key:f.id},[(d(!0),w(F,null,K(f.reply,(oe,ae)=>(d(),h(ce,{key:ae,class:"mb-[16px]",content:oe,typing:f.loading,time:f.create_time,title:f.title,"show-rewrite":!!f.extra&&!t(L),"record-id":f.id,index:ae,onCopy:ge,onAgain:ue=>Be(f),onRewrite:ue=>t($e)(f)},null,8,["content","typing","time","title","show-rewrite","record-id","index","onAgain","onRewrite"]))),128))],64))),128))],512)):le("",!0),xe(c("div",ga,[c("div",{class:"flex items-center mb-[16px]"},[ya,c("div",{class:"bg-[#f2f2f2] text-sm px-[15px] py-[2px] rounded-full cursor-pointer",onClick:Xe}," 清空记录 ")]),c("div",ha,[(d(!0),w(F,null,K(t(x).lists,(f,G)=>(d(),w(F,{key:f.id},[(d(!0),w(F,null,K(f.reply,(oe,ae)=>(d(),w("div",{key:ae,class:"mb-[16px]"},[y(ce,{class:"cursor-pointer h-full",content:oe,time:f.create_time,title:f.title,overflow:!0,"record-id":f.id,"show-voice":t(V).getIsVoiceOpen,index:ae,onClick:ue=>et(f.title,oe),"show-rewrite":!!f.extra,onCopy:ge,onAgain:ue=>Be(f),onRewrite:ue=>t($e)(f)},null,8,["content","time","title","record-id","show-voice","index","onClick","show-rewrite","onAgain","onRewrite"])]))),128))],64))),128))])],512),[[Ke,t(x).lists.length]])]),_:1},512)):(d(),w("div",xa,ka))])),[[dt,t(x).loading]])]),y(J,{ref_key:"createRecordPreviewRef",ref:k,content:t(P).content,title:t(P).title,onCopy:ge},null,8,["content","title"]),y(M,{ref_key:"guidedPopupRef",ref:j},null,512)]),_:1})}}});const vl=Q(Va,[["__scopeId","data-v-b4c874e6"]]);export{vl as default};
