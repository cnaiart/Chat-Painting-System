import{O as E,C as F,q as m,V as I,W as a,K as c,T as L,X as S,Y as B,Z as C,$ as D}from"./entry.c7e0e7b4.js";import{f as P,g as U,h as q}from"./drawing.3efa226d.js";import{u as H}from"./usePolling.272d8056.js";const V=()=>{const l=E(),r=F({prompt:"",action:"generate",image_base:"",other:"",image_id:"",model:"",scale:"1:1",no_content:"",version:"",style:"default",engine:"",quality:"standard"}),i=m(!1),u=m([]),d=m(3),p=[{name:"全部",value:-1},{name:"绘画完成",value:3},{name:"进行中",value:1},{name:"绘画失败",value:2}];let h=null;const v=async e=>{if(!e.length){c.msgError("请选择需要删除的图片");return}try{await c.confirm("是否确认删除当前绘画？"),await P({ids:e}),c.msgSuccess("删除成功"),g(),await n()}catch(t){console.log("删除失败绘画记录",t)}},n=async()=>{const e=await h();u.value=T(e.lists),u.value.length&&_()},T=e=>e.filter(t=>(t.status===1||t.status==0)&&t.loading).map(t=>t.id),y=async e=>{console.log("分页列表"),g(),await L(),h=e,await n()},k=()=>{const e=async()=>{const R=C();try{const o=await q({records_id:u.value});return(o.filter(s=>(s.status==3&&!R.fullPath.includes("/app/drawing")?D({title:"绘画成功",message:"请前往绘画记录查看",type:"success",duration:1e4}):s.status==2&&!R.fullPath.includes("/app/drawing")&&D({title:"绘画失败",message:s.fail_reason,type:"error",duration:1e4}),s.status==3||s.status==2||!s.loading)).length||!o.length)&&(w(),t()),o}catch(o){w(),console.log("获取详情失败=>",o)}},t=async()=>{await n(),await l.getUser()},{start:f,end:w,result:b}=H(e,{totalTime:6e5,time:2e3,callback:t});return{start:f,end:w,result:b}},{start:_,end:g}=k();I(()=>{});const x=async e=>{if(!l.isLogin)return l.toggleShowLogin(!0);if(!e.drawing.prompt)return c.msgError("请输入绘画描述！");d.value=-1,i.value=!0;try{g(),await U(e.drawing),e.isClear&&(r.prompt="",r.image_base="",r.no_content="",r.other=""),await n()}catch(t){const f=S();if(t==="余额不足"){await B.confirm("绘画余额不足，请前往充值","绘画余额不足",{confirmButtonText:"前往充值",cancelButtonText:"取消",type:"warning"}),f.push("/openvip?type=recharge");return}console.log("绘制失败=>",t),await n()}finally{i.value=!1}};return a("drawForm",r),a("isReceiving",i),a("taskIndex",d),a("taskLists",p),a("deleteDrawing",v),a("setTaskRecordFunc",y),a("drawingHandler",x),{isReceiving:i,taskIndex:d,taskLists:p,deleteDrawing:v,setTaskRecordFunc:y,useDetails:k,drawingHandler:x}};export{V as useIndexEffect};
