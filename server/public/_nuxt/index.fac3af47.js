import{a as Q,q as I,a1 as W,s as X,o as u,h as m,f as v,e as c,u as e,c as fe,x as ne,t as R,F as $,y as q,k as ve,H as ge,cC as oe,O as ie,K as F,b as le,w as V,z as ce,r as G,B as he,p as xe,l as ye,X as we,Z as Ce,S as ke,C as Y,cM as K,M as Le,cW as se,T as A,Q as Se,cX as Ee,Y as Ie,j as $e,cY as Te}from"./entry.c7e0e7b4.js";import{E as be}from"./index.ade63ee3.js";import{_ as re}from"./index.vue.3dfb5dc9.js";/* empty css                     */import{u as Be}from"./useLockFn.d62becec.js";import{d as Ae,e as Ve,f as De,h as Re,i as ze,b as Ne,c as Pe,a as Ue,s as Me}from"./chat.bab8475b.js";import{_ as ue}from"./_plugin-vue_export-helper.c27b6911.js";import{_ as qe}from"./chatting.908f8808.js";import{a as Fe}from"./model-picker.vue.0083d776.js";import{u as ae}from"./asyncData.f818c9f5.js";import{u as He}from"./index.88b551d2.js";import"./index.aad710b7.js";/* empty css                */import"./el-tooltip.4ed993c7.js";/* empty css                  */import"./index.67b2792c.js";import"./index.b72cfc4b.js";import"./dropdown.ee5c9419.js";/* empty css                   */import"./index.fa4f9017.js";import"./index.cb3770be.js";import"./useCopy.162cbe26.js";import"./my.94b48df2.js";import"./index.222a6e13.js";import"./refs.94480413.js";/* empty css                  */import"./download.76c7fb53.js";import"./qrcode.vue.esm.3fb480da.js";import"./recharge.573a4938.js";import"./index.ba068d27.js";import"./index.cd5f7601.js";import"./strings.d42ea6f6.js";import"./isEqual.5a66db24.js";import"./_getTag.b4ecd864.js";import"./debounce.2af106a8.js";/* empty css                  *//* empty css               */import"./_commonjsHelpers.042e6b4d.js";import"./katex.c0798897.js";import"./client-only.97a86643.js";const je={class:"ml-[10px] flex-1 min-w-0"},Je={key:1,class:"line-clamp-1"},Oe=Q({__name:"item",props:{modelValue:{},name:{},itemId:{}},emits:["update:modelValue","edit","delete"],setup(h,{emit:o}){const n=h,a=I(""),_=I(!1),x=W({get(){return n.modelValue},set(i){o("update:modelValue",i)}}),r=W(()=>x.value===n.itemId),C=()=>{_.value=!1,o("edit",n.itemId,a.value)};return X(()=>n.modelValue,()=>{_.value=!1}),X(()=>n.name,i=>{a.value=i},{immediate:!0}),(i,t)=>{const s=re,y=ge;return u(),m("div",{class:ve(["px-[10px] h-[40px] flex items-center rounded-[8px] mb-[10px] cursor-pointer",{"bg-page":e(r)}]),onClick:t[4]||(t[4]=w=>x.value=i.itemId)},[v(s,{name:"el-icon-ChatDotRound"}),c("div",je,[e(_)?(u(),fe(y,{key:0,modelValue:e(a),"onUpdate:modelValue":t[0]||(t[0]=w=>ne(a)?a.value=w:null),size:"small"},null,8,["modelValue"])):(u(),m("div",Je,R(i.name),1))]),e(r)?(u(),m($,{key:0},[e(_)?(u(),m($,{key:0},[c("div",{class:"cursor-pointer mr-[6px] flex",onClick:C},[v(s,{name:"el-icon-Select"})]),c("div",{class:"cursor-pointer flex",onClick:t[1]||(t[1]=w=>_.value=!1)},[v(s,{name:"el-icon-CloseBold"})])],64)):(u(),m($,{key:1},[c("div",{class:"cursor-pointer mr-[6px] flex",onClick:t[2]||(t[2]=w=>_.value=!0)},[v(s,{name:"el-icon-EditPen"})]),c("div",{class:"cursor-pointer flex",onClick:t[3]||(t[3]=w=>o("delete",i.itemId))},[v(s,{name:"el-icon-Delete"})])],64))],64)):q("",!0)],2)}}});function de(){const h=oe(()=>0,"$RLLxW58MNg"),o=oe(()=>[],"$HnitLJ58Ut"),n=async()=>{const s=await Ae({page_type:0});return o.value=(s==null?void 0:s.lists)||[],h.value===0&&i(),o.value},a=ie(),_=async()=>{if(!a.isLogin)return a.toggleShowLogin(!0);await Ve({}),await n(),i()},x=async s=>{await F.confirm("确定删除该会话？"),await De({id:s}),await n(),i()},r=async()=>{if(!a.isLogin)return a.toggleShowLogin(!0);await F.confirm("确定清除所有会话？"),await Re(),await n(),i()},C=async(s,y)=>{await ze({id:s,name:y}),n()},i=()=>{var s;h.value=((s=o.value[0])==null?void 0:s.id)||0},t=W(()=>{var s;return((s=o.value.find(y=>y.id===h.value))==null?void 0:s.name)||""});return{getSessionLists:n,sessionActive:h,sessionLists:o,sessionAdd:_,sessionEdit:C,sessionDelete:x,sessionClear:r,currentSession:t}}const Ye=h=>(xe("data-v-cb199066"),h=h(),ye(),h),Ke={class:"session flex flex-col bg-white"},We={class:"p-[16px]"},Xe={class:"flex-1 min-h-0"},Ge={class:"px-[16px]"},Qe={class:"p-[16px]"},Ze=Ye(()=>c("span",{class:"ml-[10px]"},"清除所有会话",-1)),et=Q({__name:"index",setup(h){const{sessionLists:o,sessionAdd:n,sessionEdit:a,sessionDelete:_,sessionClear:x,sessionActive:r}=de(),{lockFn:C,isLock:i}=Be(async()=>{await n()}),t=le();return t.getChatConfig.is_reopen&&(C(),t.getChatConfig.is_reopen=0),(s,y)=>{const w=he,H=be,j=re;return u(),m("div",Ke,[c("div",We,[v(w,{type:"primary",class:"w-full !h-[40px] !border-none !rounded-[8px]",loading:e(i),style:{background:`linear-gradient(
                        90deg,
                        var(--gradient-1) 0%,
                        var(--gradient-2) 100%
                    )`},onClick:e(C)},{default:V(()=>[ce(" + 新建会话 ")]),_:1},8,["loading","onClick"])]),c("div",Xe,[v(H,null,{default:V(()=>[c("div",Ge,[(u(!0),m($,null,G(e(o),l=>(u(),m("div",{key:l.id},[v(Oe,{modelValue:e(r),"onUpdate:modelValue":y[0]||(y[0]=k=>ne(r)?r.value=k:null),"item-id":l.id,name:l.name,onEdit:e(a),onDelete:e(_)},null,8,["modelValue","item-id","name","onEdit","onDelete"])]))),128))])]),_:1})]),c("div",Qe,[v(w,{class:"w-full",onClick:e(x)},{default:V(()=>[v(j,{name:"el-icon-Delete"}),Ze]),_:1},8,["onClick"])])])}}});const tt=ue(et,[["__scopeId","data-v-cb199066"]]),ot={class:"h-full flex"},st=["onClick"],at={key:0,class:"px-[50px]"},nt={class:"my-[60px] text-center text-[30px] font-medium"},it={class:"flex"},lt={class:"flex flex-col justify-center items-center mb-[20px]"},ct=["src"],rt={class:"text-[16px] font-medium mt-[16px]"},ut=["onClick"],dt={class:"line-clamp-2"},pt=Q({__name:"index",async setup(h){let o,n;const a=ie(),_=le();we();const x=Ce(),r=I(null),C=ke(),i=Y({model:"",network:!1}),{sessionActive:t,sessionAdd:s,currentSession:y,sessionEdit:w,getSessionLists:H}=([o,n]=K(()=>de()),o=await o,n(),o);[o,n]=K(()=>ae(()=>H(),{default(){return[]},immediate:!0},"$hwLCnUHFEe")),await o,n();const{data:j}=([o,n]=K(()=>ae(()=>Me({type:1}),"$lpd0zFTwpB")),o=await o,n(),o),l=I([]),k=Y({type:1,category_id:t.value,page_type:1,page_no:1,page_size:15}),z=I(!1),J=I(!1);let D=0;const N=async d=>{var p;J.value=!0,z.value=!0;try{const f=document.getElementsByClassName("contentList")[0],S=await Ne({...k,page_no:d?1:k.page_no,page_size:d?1:k.page_size}),{page_no:b,page_size:B}=k;(b*B>S.count||l.value.length/2>=S.count)&&(z.value=!1);const g=S.lists.map(E=>E.type==1?{...E,from_avatar:a.userInfo.avatar}:{...E,from_avatar:_.config.chat.chat_logo});d?(l.value.splice(-2,2),l.value=[...l.value,...g]):l.value=[...g,...l.value],await A();const L=Object.freeze(f==null?void 0:f.getBoundingClientRect());L&&D&&((p=r.value)==null||p.scrollTo(L.height-D)),D=L.height}catch(f){console.log("聊天记录错误",f)}finally{J.value=!1}},Z=()=>{z.value&&D&&(k.page_no+=1,N())},{pauseAll:pe}=He(),T=I(!1),O=I(""),ee=async d=>{if(!a.isLogin)return a.toggleShowLogin(!0);if(T.value)return;if(a.userInfo.is_chat_limit&&Ee(!0,Te))try{await Ie.confirm("已超过会员对话上限次数，继续对话将会消耗账户的对话余额","对话上限提示",{showClose:!1,confirmButtonText:"继续",cancelButtonText:"关闭"})}catch{return}t.value===0&&await s(),y.value==="新的会话"&&await w(t.value,d),O.value=d,l.value.push({type:1,content:d,from_avatar:a.userInfo.avatar});const p=Y({type:2,loading:!0,content:[],create_time:" ",from_avatar:_.config.chat.chat_logo,id:""});l.value.push(p),T.value=!0;try{await Pe({question:d,type:1,other_id:t.value,...i},{onstart(f){P=f,pe()},onmessage(f){f.trim().split("data:").forEach(async S=>{var b;if(S!=="")try{const B=JSON.parse(S),{id:g,code:L,event:E,data:U,index:M,incremental:_e}=B;if(E=="error"&&L===101?(b=C.value)==null||b.open():E=="error"&&(F.msgError(U),r.value.setInput(O.value)),U&&(p.content[M]||(p.content[M]=""),p.content[M]=_e?p.content[M]+U:U),E==="finish"){p.loading=!1;return}}catch{}})},onclose(){T.value=!1,setTimeout(async()=>{await N(!0),await A(),r.value.scrollToBottom()},600),a.getUser()}})}catch(f){console.log(f),T.value=!1,r.value.setInput(O.value),l.value.splice(l.value.length-2,2)}A(()=>{r.value.scrollToBottom()})};let P=null;const te=d=>{P==null||P.cancel(),d&&(l.value[d].loading=!1),T.value=!1},me=async()=>{console.log(),await F.confirm("确定清空对话？"),await Ue({type:1,category_id:t.value}),l.value=[]};return Le(async()=>{if(x.query.cid||x.query.user_sn){const d=se("cid"),p=se("user_sn");d.value=x.query.cid,p.value=x.query.user_sn,await A(),a.checkShare()}await N(),await A(),r.value.scrollToBottom()}),X(t,async d=>{k.category_id=d,k.page_no=1,l.value=[],D=0,te(),await N(),await A(),r.value.scrollToBottom()}),(d,p)=>{const f=tt,S=qe,b=Fe,B=$e;return u(),m("div",null,[v(B,{name:"default"},{panel:V(()=>[v(f)]),default:V(()=>[c("div",ot,[v(S,{ref_key:"chattingRef",ref:r,model:e(i).model,"onUpdate:model":p[0]||(p[0]=g=>e(i).model=g),network:e(i).network,"onUpdate:network":p[1]||(p[1]=g=>e(i).network=g),"content-list":e(l),"send-disabled":e(T),selectval:e(t),avatar:e(_).config.chat.chat_logo,"chat-type":1,onClose:te,onContentPost:ee,onCleanChatLog:me,onTop:Z},{default:V(()=>[c("div",{class:"h-[40px] py-[10px] text-[#999] text-center cursor-pointer",onClick:Se(Z,["stop"])},[e(z)&&e(a).isLogin?(u(),m($,{key:0},[ce(R(e(J)?"正在加载中...":"-- 点击加载 --"),1)],64)):q("",!0)],8,st),e(l).length?q("",!0):(u(),m("div",at,[c("div",nt,R(e(_).getChatConfig.chat_title),1),c("div",it,[(u(!0),m($,null,G(e(j).slice(0,3),g=>(u(),m("div",{key:g.id,class:"flex-1 mx-[10px]"},[c("div",lt,[g.image?(u(),m("img",{key:0,class:"w-[58px] h-[58px]",src:g.image,alt:""},null,8,ct)):q("",!0),c("div",rt,R(g.name),1)]),c("div",null,[(u(!0),m($,null,G(g.sample,L=>(u(),m("div",{key:L.id,class:"sample-item mb-[20px] p-[10px] flex justify-center cursor-pointer",onClick:E=>ee(L.content)},[c("div",dt,R(L.content),1)],8,ut))),128))])]))),128))])]))]),_:1},8,["model","network","content-list","send-disabled","selectval","avatar"])]),v(b,{ref_key:"guidedPopupRef",ref:C},null,512)]),_:1})])}}});const Zt=ue(pt,[["__scopeId","data-v-f0cd33d9"]]);export{Zt as default};
