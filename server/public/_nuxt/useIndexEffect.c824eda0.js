import{O as C,q as i,C as h,V as L,W as t,T as Q,K as r,X as S,Y as U}from"./entry.c7e0e7b4.js";import{b,c as F,d as H}from"./qrcode.9d06457e.js";import{u as B}from"./usePolling.272d8056.js";import{QrcodeModeEnum as D}from"./qrcodeEnums.e7d40609.js";const O=()=>{const l=C(),w=i(0),_=h({v:"3",iw:.45,seed:"",shape:"random",ar:"1:1"}),s=h({model:"mewx",type:1,qr_content:"",qr_image:"",prompt:"",prompt_params:"",model_id:"",template_id:"",way:1,aspect_ratio:"1:1",pixel_style:"square",marker_shape:"square"}),c=i(!1),m=i([]),u=i(3),y=[{name:"全部",value:-1},{name:"生成成功",value:3},{name:"进行中",value:1},{name:"生成失败",value:2}];let v=null;const k=async e=>{if(!e.length){r.msgError("请选择需要删除的记录");return}try{await r.confirm("是否确认删除当前记录？"),await F({ids:e}),r.msgSuccess("删除成功"),await o()}catch(a){console.log("删除失败",a)}},o=async()=>{const e=await v();m.value=x(e.lists),m.value.length&&R()},x=e=>e.filter(a=>a.status===1&&a.loading).map(a=>a.id),E=async e=>{console.log("分页列表"),d(),await Q(),v=e,await o()},I=()=>{const e=async()=>{try{const n=await H({records_id:m.value});return(n.filter(f=>f.status==3||f.status==2||!f.loading).length||!n.length)&&(p(),a()),n}catch(n){p(),console.log("获取详情失败=>",n)}},a=async()=>{await o(),await l.getUser()},{start:g,end:p,result:T}=B(e,{totalTime:48e4,time:5e3,count:96,callback:a});return{start:g,end:p,result:T}},{start:R,end:d}=I();L(()=>{d()});const q=async e=>{if(!l.isLogin)return l.toggleShowLogin(!0);if(e.params.type==2&&!e.params.qr_image)return r.msgError("请上传二维码！");if(e.params.type==1&&!e.params.qr_content)return r.msgError("请输入二维码内容！");if(D.ZHISHUYUN===e.params.model&&!e.params.prompt)return r.msgError("请输入生成方式！");u.value=-1,c.value=!0;try{d(),await b(e.params),e.isClear&&(s.prompt="",s.qr_image="",s.qr_content=""),await o()}catch(a){const g=S();if(a==="余额不足"){await U.confirm("绘画余额不足，请前往充值","绘画余额不足",{confirmButtonText:"前往充值",cancelButtonText:"取消",type:"warning"}),g.push("/openvip?type=recharge");return}console.log("绘制失败=>",a),await o()}finally{c.value=!1}};return t("consumptionCount",w),t("promptParams",_),t("qrcodeForm",s),t("isReceiving",c),t("taskIndex",u),t("taskLists",y),t("deleteQrcode",k),t("drawingHandler",q),{consumptionCount:w,qrcodeForm:s,isReceiving:c,taskIndex:u,taskLists:y,setTaskRecordFunc:E,drawingHandler:q}};export{O as useIndexEffect};
