import{d as e,O as a,r as t,P as s,c as l,x as r,a3 as o,b_ as u,w as c,Z as i,a8 as d,a9 as n,a as p,b as m,o as f,i as _,g as x,f as h,h as y,F as v,m as w,e as g,t as b,u as k,j as C,p as I,aV as A,c0 as j,aW as S,a1 as P,b$ as E,k as F,aF as L,ak as N,A as O,C as R,K as V,D as U,E as W,J as z}from"./index-c4e9cb21.js";import{_ as D}from"./page-meta.0a6ed5a4.js";import{_ as q}from"./u-image.259ae993.js";import{P as B,b as X,_ as M,g as G,p as $,a as H}from"./check.vue_vue_type_script_setup_true_lang.7eaabe0a.js";import{_ as T}from"./u-button.d1dcbae7.js";import{_ as Z}from"./u-empty.8b31fa6b.js";import{_ as J}from"./u-icon.9d0b6bc8.js";import{_ as K,a as Q}from"./u-radio-group.2d2333d3.js";import{_ as Y}from"./page-status.8f3a35bf.js";import{_ as ee}from"./u-popup.550d714f.js";import{u as ae}from"./useLockFn.bbb1f608.js";import{_ as te}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as se}from"./router-navigate.7694f14d.js";import{_ as le}from"./tabbar.vue_vue_type_script_setup_true_lang.de757f7b.js";import{F as re}from"./floating-menu.33dda305.js";import"./emitter.1571a5d9.js";import"./u-loading.5334235e.js";import"./u-badge.4654495c.js";const oe=te(e({__name:"payment",props:{show:{type:Boolean,required:!0},showCheck:{type:Boolean},orderId:{type:Number,required:!0},from:{type:String,required:!0},redirect:{type:String},orderAmount:{type:Number},safeArea:{type:Boolean,required:!0}},emits:["update:showCheck","update:show","close","success","fail"],setup(e,{emit:L}){const N=e;a();const O=t(),R=t(s.LOADING),V=t({lists:[]}),U=l({get:()=>N.showCheck,set(e){L("update:showCheck",e)}}),W=l({get:()=>N.show,set(e){L("update:show",e)}}),z=()=>{W.value=!1,L("close")},D=r(),q=async e=>{try{P({title:"正在支付中"});const a=await $({device:E(),order_id:N.orderId,from:N.from,pay_way:O.value,redirect:N.redirect,code:e});return await H.payment(a.pay_way,(null==a?void 0:a.config)||(null==a?void 0:a.payurl)||(null==a?void 0:a.qrcode))}catch(a){return Promise.reject(a)}},{isLock:te,lockFn:se}=ae((async()=>{try{const e=await(async()=>{if(0==D.userInfo.is_auth&&[A.OA_WEIXIN,A.MP_WEIXIN].includes(j)&&O.value==B.WECHAT)switch(j){case A.OA_WEIXIN:return d.getUrl(n.BASE,"snsapi_base",{id:N.orderId,from:N.from}),Promise.reject();case A.MP_WEIXIN:return(await S()).code}})(),a=await q(e);le(a),o()}catch(e){o(),console.log(e)}})),le=e=>{switch(e){case u.SUCCESS:L("success");break;case u.FAIL:L("fail")}},re=()=>{le(u.SUCCESS)},oe=()=>{W.value=!0,le(u.FAIL)};return c((()=>N.show),(async e=>{if(e){if(!N.orderId)return void(R.value=s.ERROR);await(async()=>{R.value=s.LOADING;try{V.value=await G({order_id:N.orderId,from:N.from}),R.value=s.NORMAL;const e=V.value.lists.find((e=>e.is_default))||V.value.lists[0];O.value=null==e?void 0:e.pay_way}catch(e){R.value=s.ERROR}})()}}),{immediate:!0}),i((async()=>{const e=d.getAuthData();if(e.code&&e.scene===n.BASE){O.value=B.WECHAT,W.value=!0;try{const a=await q(e.code);le(a),o()}catch(a){o(),console.log(a)}finally{d.setAuthData({})}}})),(a,t)=>{const s=p(m("u-empty"),Z),l=F,r=p(m("u-icon"),J),o=p(m("u-radio"),K),u=p(m("u-radio-group"),Q),c=p(m("price"),X),i=p(m("u-button"),T),d=p(m("page-status"),Y),n=p(m("u-popup"),ee);return f(),_(v,null,[x(n,{modelValue:k(W),"onUpdate:modelValue":t[1]||(t[1]=e=>I(W)?W.value=e:null),mode:"bottom","safe-area-inset-bottom":e.safeArea,"mask-close-able":!1,"border-radius":"14",closeable:"","z-index":899,onClose:z},{default:h((()=>[x(l,{class:""},{default:h((()=>[x(d,{status:R.value,fixed:!1},{error:h((()=>[x(s,{text:"订单信息错误，无法查询到订单信息",mode:"order"})])),default:h((()=>[x(l,{class:"payment w-full pb-[20rpx]"},{default:h((()=>[x(l,{class:"header py-[50rpx] flex flex-col items-center"},{default:h((()=>[x(l,{class:"text-[34rpx]"},{default:h((()=>[y("选择支付方式")])),_:1})])),_:1}),x(l,{class:"main min-h-[300rpx] mx-[20rpx]"},{default:h((()=>[x(l,null,{default:h((()=>[x(l,{class:"payway-lists"},{default:h((()=>[x(u,{modelValue:O.value,"onUpdate:modelValue":t[0]||(t[0]=e=>O.value=e),class:"w-full","active-color":a.$theme.primaryColor},{default:h((()=>[(f(!0),_(v,null,w(V.value.lists,((e,a)=>(f(),g(l,{class:"p-[20rpx] flex items-center w-full payway-item",key:a,onClick:a=>{return t=e.pay_way,void(O.value=t);var t}},{default:h((()=>[x(r,{class:"flex-none",size:48,name:e.icon},null,8,["name"]),x(l,{class:"mx-[16rpx] flex-1"},{default:h((()=>[x(l,{class:"payway-item--name flex-1"},{default:h((()=>[y(b(e.name),1)])),_:2},1024),x(l,{class:"text-muted text-xs"},{default:h((()=>[y(b(e.extra),1)])),_:2},1024)])),_:2},1024),x(o,{class:"mr-[-20rpx]",name:e.pay_way},null,8,["name"])])),_:2},1032,["onClick"])))),128))])),_:1},8,["modelValue","active-color"])])),_:1})])),_:1})])),_:1}),x(l,{class:"submit-btn p-[20rpx] mt-[50rpx]"},{default:h((()=>[x(i,{onClick:k(se),shape:"circle",type:"primary",loading:k(te)},{default:h((()=>[y(" 立即支付 "),e.orderAmount?(f(),g(c,{key:0,content:e.orderAmount,mainSize:"34rpx",minorSize:"34rpx",fontWeight:"500",color:"var(--color-btn-text)"},null,8,["content"])):C("v-if",!0)])),_:1},8,["onClick","loading"])])),_:1})])),_:1})])),_:1},8,["status"])])),_:1})])),_:1},8,["modelValue","safe-area-inset-bottom"]),x(M,{show:k(U),"onUpdate:show":t[2]||(t[2]=e=>I(U)?U.value=e:null),from:e.from,"order-id":e.orderId,onSuccess:re,onFail:oe},null,8,["show","from","order-id"])],64)}}}),[["__scopeId","data-v-eea9fb4c"]]);const ue=te(e({__name:"recharge",setup(e){const a=t(s.LOADING),l=t({lists:[]});N();const r=t({is_open:1,tips:"立即支付"}),u=t(),c=O({orderId:"",from:"recharge",showPay:!1,orderAmount:"",showCheck:!1,showPaySuccess:!1}),{isLock:i,lockFn:d}=ae((async e=>{P({mask:!0,title:"请稍后..."});try{const a=await function(e){return L.post({url:"/recharge/recharge",data:e},{isAuth:!0})}({recharge_package_id:e});c.orderId=a.order_id,c.showPay=!0,c.orderAmount=a.order_amount}catch(a){}finally{o()}})),n=async()=>{c.showPay=!1,c.showPaySuccess=!0},I=async()=>{var e;l.value=await L.get({url:"/recharge/rechargePackage"},{isAuth:!0}),u.value=(null==(e=l.value.lists.find((e=>e.is_default)))?void 0:e.id)||""},A=async()=>{try{await Promise.all([I()]),a.value=s.NORMAL}catch(e){a.value=s.ERROR}};return R((async()=>{A()})),V((e=>{((null==e?void 0:e.id)||e["amp;id"])&&(e.from||e["amp;from"])&&(c.orderId=(null==e?void 0:e.id)||e["amp;id"],c.from=e.from||e["amp;from"]),(null==e?void 0:e.checkPay)&&(c.showCheck=!0)})),U((async()=>{try{await A()}catch(e){}W()})),(e,t)=>{const s=p(m("page-meta"),D),o=F,i=p(m("u-image"),q),I=p(m("price"),X),A=p(m("u-button"),T),j=p(m("u-empty"),Z),S=p(m("payment"),oe),P=p(m("u-icon"),J),E=z,L=p(m("router-navigate"),se),N=p(m("u-popup"),ee),O=p(m("page-status"),Y),R=p(m("tabbar"),le);return f(),_(v,null,[x(s,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),r.value.is_open?(f(),g(O,{key:0,status:a.value},{error:h((()=>[x(j,{text:"加载出错～"})])),default:h((()=>[l.value.status?(f(),g(o,{key:0,class:"task-center"},{default:h((()=>[x(o,{class:"pb-[20rpx]"},{default:h((()=>{var e;return[(null==(e=l.value.lists)?void 0:e.length)?(f(),g(o,{key:0,class:"recharge overflow-hidden"},{default:h((()=>[x(o,{class:"tasks-title"},{default:h((()=>[x(o,{class:"font-medium text-xl"},{default:h((()=>[y("充值套餐")])),_:1}),x(o,{class:"ml-[14rpx] text-muted text-sm"},{default:h((()=>[y(" VIP期间对话不消耗次数，次数永不过期 ")])),_:1})])),_:1}),x(o,{class:"recharge-template flex flex-wrap px-[30rpx] mx-[-10rpx]"},{default:h((()=>[(f(!0),_(v,null,w(l.value.lists,(e=>(f(),g(o,{class:"w-1/2 mb-[20rpx]",key:e.id,onClick:a=>u.value=e.id},{default:h((()=>[x(o,{class:"flex flex-col rounded-[16rpx] mx-[10rpx] h-full border-[1px] border-solid border-light overflow-hidden relative"},{default:h((()=>[x(o,{class:"pt-[60%] relative w-full h-0"},{default:h((()=>[x(o,{class:"absolute left-0 right-0 bottom-0 top-0"},{default:h((()=>[x(i,{width:"100%",height:"100%",src:e.image,mode:"aspectFill"},null,8,["src"])])),_:2},1024)])),_:2},1024),e.tag?(f(),g(o,{key:0,class:"absolute top-[-1px] left-[-1px] bg-[#FF3232] text-white text-sm rounded-[8rpx] px-[20rpx] py-[8rpx] max-w-[100%]"},{default:h((()=>[y(b(e.tag),1)])),_:2},1024)):C("v-if",!0),x(o,{class:"p-[20rpx] flex-1 min-h-0 flex flex-col"},{default:h((()=>[x(o,null,{default:h((()=>[x(I,{content:e.sell_price,mainSize:"40rpx",minorSize:"28rpx",color:"#FF2C3C",fontWeight:500},null,8,["content"])])),_:2},1024),x(o,{class:"text-xl font-medium mt-[12rpx] line-clamp-1"},{default:h((()=>[y(b(e.name),1)])),_:2},1024),x(o,{class:"text-sm text-muted mt-[20rpx] line-clamp-3"},{default:h((()=>[y(b(e.describe),1)])),_:2},1024),x(o,{class:"mt-auto"},{default:h((()=>[x(o,{class:"flex flex-wrap justify-between mt-[20rpx] text-sm"},{default:h((()=>[x(o,{class:"mr-[20rpx] flex-none"},{default:h((()=>[y(" 对话次数: "+b(e.number),1)])),_:2},1024),e.is_give&&e.give_number?(f(),g(o,{key:0,class:"text-primary"},{default:h((()=>[y(" +"+b(e.give_number),1)])),_:2},1024)):C("v-if",!0)])),_:2},1024),x(o,{class:"flex flex-wrap justify-between mt-[12rpx] text-sm"},{default:h((()=>[x(o,{class:"mr-[10px] flex-none"},{default:h((()=>[y(" 绘画次数: "+b(e.draw_number),1)])),_:2},1024),e.is_give&&e.give_draw_number?(f(),g(o,{key:0,class:"text-primary"},{default:h((()=>[y(" +"+b(e.give_draw_number),1)])),_:2},1024)):C("v-if",!0)])),_:2},1024),r.value.is_open?(f(),g(o,{key:0,class:"pt-[30rpx] pb-[10rpx]"},{default:h((()=>[x(A,{"custom-style":{width:"100%",height:"68rpx",fontSize:"28rpx"},type:"primary",shape:"circle",onClick:a=>k(d)(e.id)},{default:h((()=>[y(" 立即充值 ")])),_:2},1032,["onClick"])])),_:2},1024)):C("v-if",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):C("v-if",!0)]})),_:1})])),_:1})):(f(),g(o,{key:1,class:"py-[400rpx]"},{default:h((()=>[x(j,{text:"功能未开启"})])),_:1})),x(S,{show:c.showPay,"onUpdate:show":t[0]||(t[0]=e=>c.showPay=e),"order-id":c.orderId,showCheck:c.showCheck,"onUpdate:showCheck":t[1]||(t[1]=e=>c.showCheck=e),from:c.from,redirect:"/packages/pages/recharge/recharge","order-amount":c.orderAmount,onSuccess:n},null,8,["show","order-id","showCheck","from","order-amount"]),x(N,{modelValue:c.showPaySuccess,"onUpdate:modelValue":t[3]||(t[3]=e=>c.showPaySuccess=e),"safe-area-inset-bottom":!0,"mask-close-able":!1,"border-radius":"14","z-index":899,round:"",mode:"center",width:"600"},{default:h((()=>[x(o,{class:"pt-[20rpx]"},{default:h((()=>[x(o,{class:"px-[30rpx] py-[40rpx]"},{default:h((()=>[x(o,{class:"text-success text-center"},{default:h((()=>[x(P,{name:"checkmark-circle-fill",size:"100"})])),_:1}),x(o,{class:"text-xl font-medium mt-[20rpx] text-center"},{default:h((()=>[y(" 支付成功 ")])),_:1}),x(o,{class:"flex mt-[60rpx]"},{default:h((()=>[x(o,{class:"flex-1"},{default:h((()=>[x(o,{class:"h-[72rpx] leading-[72rpx] rounded-full bg-page text-center",onClick:t[2]||(t[2]=e=>c.showPaySuccess=!1)},{default:h((()=>[x(E,null,{default:h((()=>[y("继续充值")])),_:1})])),_:1})])),_:1}),x(o,{class:"flex-1 ml-[20rpx]"},{default:h((()=>[x(L,{class:"h-[72rpx] leading-[72rpx] rounded-full bg-primary text-center text-btn-text",to:"/pages/index/index","nav-type":"reLaunch"},{default:h((()=>[x(E,null,{default:h((()=>[y("返回首页")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["status"])):(f(),g(o,{key:1,class:"h-full flex justify-center items-center"})),C("    悬浮菜单    "),x(re),x(R)],64)}}}),[["__scopeId","data-v-ac415be9"]]);export{ue as default};
