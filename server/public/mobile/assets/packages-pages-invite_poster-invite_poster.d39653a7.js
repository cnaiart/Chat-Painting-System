import{d as t,l as a,x as s,W as e,r as o,A as l,c as n,o as r,e as i,f as u,j as p,g as d,u as c,ay as f,a3 as m,a as x,b as g,z as _,P as v,Z as y,D as h,E as b,i as w,h as F,t as j,F as k,a1 as U,H as $,k as z}from"./index-c4e9cb21.js";import{_ as D}from"./page-meta.0a6ed5a4.js";import{_ as P}from"./u-loading.5334235e.js";import{_ as R}from"./u-image.259ae993.js";import{_ as T}from"./u-button.d1dcbae7.js";import{_ as S}from"./page-status.8f3a35bf.js";import{b as I,a as N,_ as O,c as q}from"./l-painter.e1bc292c.js";import{_ as A}from"./u-empty.8b31fa6b.js";import{F as C}from"./floating-menu.33dda305.js";import{_ as L}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-icon.9d0b6bc8.js";const E=t({__name:"invite-poster",props:{options:{default:{code:{x:"",y:""},data:{content:"邀请您前来体验",x:"",y:""},default:1,defaultUrl1:"",defaultUrl2:"",posterUrl:"",showData:0}}},emits:["fail","success"],setup(t,{expose:_,emit:v}){const y=t,{getImageUrl:h,config:b}=a(),w=s(),{userInfo:F}=e(w),j=o(),k=l({qrcode:"",link:""}),U=n((()=>{const t=null==y?void 0:y.options;return 1==t.default&&1==t.poster?h(t.defaultUrl1):1==t.default&&2==t.poster?h(null==y?void 0:y.options.defaultUrl2):2==t.default?h(t.posterUrl):void 0})),$=()=>{var t;try{console.log("props",y),null==(t=j.value)||t.canvasToTempFilePathSync({fileType:"png",pathType:"base64",quality:1,success:t=>{console.log("生成结果",t),m(),v("success",t.tempFilePath)},fail:t=>{console.log(t),m(),uni.$u.toast("调用海报错误",t)}})}catch(a){m(),uni.$u.toast("调用海报错误")}};return _({drawCanvas:$,initPosterData:async()=>{var t;try{(null==(t=null==F?void 0:F.value)?void 0:t.sn)||await w.getUser();const a=window.origin;k.link=`${a}/mobile/pages/index/index?user_sn=${F.value.sn}`,await f(),await $()}catch(a){console.log(a)}}}),(a,s)=>{const e=x(g("l-painter-qrcode"),I),o=x(g("l-painter-text"),N),l=x(g("l-painter-view"),O),n=x(g("l-painter"),q);return r(),i(n,{ref_key:"painterRef",ref:j,isCanvasToTempFilePath:!1,"after-delay":300,css:`width: 540rpx; background-image: url(${c(U)});`,"custom-style":"position: fixed; left: 200%; height: 900rpx;"},{default:u((()=>[p("  主要视图  "),d(l,{css:"\n                position: relative;\n                display: block;\n                box-sizing: border-box;\n                border-radius: 14rpx;\n                width: 100%;\n                height: 900rpx;\n            "},{default:u((()=>{var a,s,l,n,u,c,f,m,x,g;return[p("  H5二维码  "),d(e,{css:`\n                    box-sizing: border-box;\n                    position: absolute;\n                    z-index: 10;\n                    top: ${2*(null==(s=null==(a=t.options)?void 0:a.code)?void 0:s.y)}rpx;\n                    left:${2*(null==(n=null==(l=t.options)?void 0:l.code)?void 0:n.x)}rpx;\n                    width: 200rpx;\n                    height: 200rpx;\n                    padding: 10rpx;\n                    background-color: #FFFFFF;\n                `,text:k.link},null,8,["css","text"]),p("  邀请文案  "),t.options.showData?(r(),i(o,{key:0,text:null==(c=null==(u=t.options)?void 0:u.data)?void 0:c.content,css:`\n                    position: absolute;\n                    z-index: 10;\n                    display: block;\n                    color: #FFFFFF;\n                    font-size: 28rpx;\n                    top: ${2*(null==(m=null==(f=t.options)?void 0:f.data)?void 0:m.y)}rpx;\n                    left:${2*(null==(g=null==(x=t.options)?void 0:x.data)?void 0:g.x)}rpx;\n                `},null,8,["text","css"])):p("v-if",!0)]})),_:1})])),_:1},8,["css"])}}}),H=L(t({__name:"invite_poster",setup(t){const a=s();e(a);const o=_(),n=l({status:v.LOADING,status_text:"服务器请求错误，请稍后再试",poster_params:{code:{x:"",y:""},data:{content:"邀请您前来体验",x:"",y:""},default:1,defaultUrl1:"",defaultUrl2:"",poster:1,posterUrl:"",showData:1},rule_desc:{enabled:1,name:"邀请说明",data:""},poster_url:""}),I=async()=>{var t,a;await U({title:"生成中"});try{const s=await $({id:5}),e=JSON.parse(s.data);n.poster_params=(null==(t=e[0])?void 0:t.content)||{},n.rule_desc=(null==(a=e[1])?void 0:a.content)||{},await f(),n.status=v.NORMAL,await o.value.initPosterData()}catch(s){m(),n.status_text=s,n.status=v.ERROR,console.log("获取邀请海报装修失败",s)}},N=()=>{uni.$u.toast("请长按图片保存")};return y((async()=>{await I()})),h((async()=>{I(),b()})),(t,a)=>{const s=x(g("page-meta"),D),e=x(g("u-loading"),P),l=x(g("u-image"),R),f=z,m=x(g("u-button"),T),_=x(g("page-status"),S);return r(),w(k,null,[d(s,{"page-style":t.$theme.pageStyle},null,8,["page-style"]),d(_,{status:n.status},{default:u((()=>{var t;return[d(f,{class:"flex justify-center"},{default:u((()=>[p("  海报  "),d(f,{class:"w-[540rpx] h-[900rpx] bg-white rounded-lg mt-[20rpx]"},{default:u((()=>[d(l,{width:"540",height:"900",src:n.poster_url},{loading:u((()=>[d(e)])),default:u((()=>[d(e,{slot:"loading"})])),_:1},8,["src"])])),_:1})])),_:1}),p("  邀请说明  "),(null==(t=null==n?void 0:n.rule_desc)?void 0:t.enabled)?(r(),i(f,{key:0,class:"bg-white rounded-lg m-[30rpx] p-[20rpx]"},{default:u((()=>[d(f,{class:"font-medium"},{default:u((()=>{var t;return[F(j(null==(t=null==n?void 0:n.rule_desc)?void 0:t.name),1)]})),_:1}),d(f,{class:"mt-[20rpx]"},{default:u((()=>{var t;return[F(j(null==(t=null==n?void 0:n.rule_desc)?void 0:t.data),1)]})),_:1})])),_:1})):p("v-if",!0),p("  保存按钮  "),d(f,{class:"container-bottom bg-white"},{default:u((()=>[d(f,{class:"mx-[30rpx] my-[30rpx]"},{default:u((()=>[d(m,{type:"primary",shape:"circle",size:"default",customStyle:{padding:"0 30rpx",height:"82rpx"},onClick:N},{default:u((()=>[F(" 长按保存图片到相册 ")])),_:1})])),_:1})])),_:1})]})),error:u((()=>[d(A,{"font-size":"28","icon-size":"300",text:n.status_text,src:c("/mobile/assets/error-f2045243.png")},null,8,["text","src"])])),_:1},8,["status"]),p("    悬浮菜单    "),d(C),d(E,{ref_key:"posterRef",ref:o,options:n.poster_params,onSuccess:a[0]||(a[0]=t=>{n.poster_url=t})},null,8,["options"])],64)}}}),[["__scopeId","data-v-a7910958"]]);export{H as default};
