import{_ as e}from"./page-meta.0a6ed5a4.js";import{aF as l,o as a,i as t,G as s,a as u,b as o,e as r,f as n,h as i,t as c,g as d,v as m,R as p,j as f,n as x,k as v,d as g,F as _,m as y,at as h,aG as b,l as w,r as k,u as V,a1 as C,a3 as A,au as j,y as z,z as L,w as D,ay as S,A as I,x as F,aH as R,as as U,aI as T,aJ as Z,aK as E,aA as M,aB as N,aL as O,S as q,a5 as B,c as H,p as G,J as P,aM as K,ar as Q,a2 as Y,aN as J,Y as W,aO as $,K as X,aa as ee}from"./index-c4e9cb21.js";import{_ as le}from"./u-empty.8b31fa6b.js";import{_ as ae}from"./tabbar.vue_vue_type_script_setup_true_lang.de757f7b.js";import{_ as te}from"./u-button.d1dcbae7.js";import{_ as se}from"./router-navigate.7694f14d.js";import{_ as ue}from"./z-paging.0c0bd55f.js";import{_ as oe}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as re}from"./u-icon.9d0b6bc8.js";import{I as ne}from"./icon_copy.2cfe0671.js";import{I as ie,a as ce,b as de,c as me,N as pe,d as fe,_ as xe,e as ve,D as ge,u as _e}from"./usePolling.6136f7cf.js";import{s as ye}from"./file.17a933ee.js";import{u as he}from"./useCopy.c5769034.js";import{_ as be}from"./u-loading.5334235e.js";import{_ as we}from"./u-image.259ae993.js";import{_ as ke}from"./u-popup.550d714f.js";import{_ as Ve}from"./u-select.739e9706.js";import{a as Ce,s as Ae}from"./square.f48e4f75.js";import{u as je}from"./useLockFn.bbb1f608.js";import{_ as ze}from"./u-tabs.30cd1122.js";import{_ as Le}from"./u-input.c26a5a94.js";import{F as De}from"./floating-menu.33dda305.js";import"./u-badge.4654495c.js";import"./emitter.1571a5d9.js";const Se=oe({},[["render",function(e,l){return a(),t("div",{class:"in-progress"},[s("div",{class:"flex justify-center items-center"},[(a(),t("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",class:"lds-balls",width:"80px",height:"80px",viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid"},[s("circle",{cx:"67.8023",cy:"59.9068",r:"6",fill:"#51CACC"},[s("animate",{attributeName:"cx",values:"75;57.72542485937369",keyTimes:"0;1",dur:"1s",repeatCount:"indefinite"}),s("animate",{attributeName:"cy",values:"50;73.77641290737884",keyTimes:"0;1",dur:"1s",repeatCount:"indefinite"}),s("animate",{attributeName:"fill",values:"#51CACC;#9DF871",keyTimes:"0;1",dur:"1s",repeatCount:"indefinite"})]),s("circle",{cx:"46.0792",cy:"69.9923",r:"6",fill:"#9DF871"},[s("animate",{attributeName:"cx",values:"57.72542485937369;29.774575140626318",keyTimes:"0;1",dur:"1s",repeatCount:"indefinite"}),s("animate",{attributeName:"cy",values:"73.77641290737884;64.69463130731182",keyTimes:"0;1",dur:"1s",repeatCount:"indefinite"}),s("animate",{attributeName:"fill",values:"#9DF871;#E0FF77",keyTimes:"0;1",dur:"1s",repeatCount:"indefinite"})]),s("circle",{cx:"29.7746",cy:"52.4491",r:"6",fill:"#E0FF77"},[s("animate",{attributeName:"cx",values:"29.774575140626318;29.774575140626315",keyTimes:"0;1",dur:"1s",repeatCount:"indefinite"}),s("animate",{attributeName:"cy",values:"64.69463130731182;35.30536869268818",keyTimes:"0;1",dur:"1s",repeatCount:"indefinite"}),s("animate",{attributeName:"fill",values:"#E0FF77;#DE9DD6",keyTimes:"0;1",dur:"1s",repeatCount:"indefinite"})]),s("circle",{cx:"41.4208",cy:"31.5213",r:"6",fill:"#DE9DD6"},[s("animate",{attributeName:"cx",values:"29.774575140626315;57.72542485937368",keyTimes:"0;1",dur:"1s",repeatCount:"indefinite"}),s("animate",{attributeName:"cy",values:"35.30536869268818;26.22358709262116",keyTimes:"0;1",dur:"1s",repeatCount:"indefinite"}),s("animate",{attributeName:"fill",values:"#DE9DD6;#FF708E",keyTimes:"0;1",dur:"1s",repeatCount:"indefinite"})]),s("circle",{cx:"64.9232",cy:"36.1304",r:"6",fill:"#FF708E"},[s("animate",{attributeName:"cx",values:"57.72542485937368;75",keyTimes:"0;1",dur:"1s",repeatCount:"indefinite"}),s("animate",{attributeName:"cy",values:"26.22358709262116;49.99999999999999",keyTimes:"0;1",dur:"1s",repeatCount:"indefinite"}),s("animate",{attributeName:"fill",values:"#FF708E;#51CACC",keyTimes:"0;1",dur:"1s",repeatCount:"indefinite"})])]))]),s("div",{class:"text-xl mt-[20px]"}," 正在生成中 "),s("div",{class:"mt-[10px] text-base text-[#999999] w-[260px] h-[60px]"}," 绘图预计花费30~60s时间，可离开后再回来查看效果喔～ ")])}],["__scopeId","data-v-f486bbb5"]]);const Ie=oe({name:"u-tag",emits:["click","close"],props:{type:{type:String,default:"primary"},disabled:{type:[Boolean,String],default:!1},size:{type:String,default:"default"},shape:{type:String,default:"square"},text:{type:[String,Number],default:""},bgColor:{type:String,default:""},color:{type:String,default:""},borderColor:{type:String,default:""},closeColor:{type:String,default:""},index:{type:[Number,String],default:""},mode:{type:String,default:"light"},closeable:{type:Boolean,default:!1},show:{type:Boolean,default:!0}},data:()=>({}),computed:{customStyle(){let e={};return this.color&&(e.color=this.color),this.bgColor&&(e.backgroundColor=this.bgColor),"plain"==this.mode&&this.color&&!this.borderColor?e.borderColor=this.color:e.borderColor=this.borderColor,e},iconStyle(){if(!this.closeable)return;let e={};return"mini"==this.size?e.fontSize="20rpx":e.fontSize="22rpx","plain"==this.mode||"light"==this.mode?e.color=this.type:"dark"==this.mode&&(e.color="#ffffff"),this.closeColor&&(e.color=this.closeColor),e},closeIconColor(){return this.closeColor?this.closeColor:this.color?this.color:"dark"==this.mode?"#ffffff":this.type}},methods:{clickTag(){this.disabled||this.$emit("click",this.index)},close(){this.$emit("close",this.index)}}},[["render",function(e,l,t,s,g,_){const y=u(o("u-icon"),re),h=v;return t.show?(a(),r(h,{key:0,class:x([[t.disabled?"u-disabled":"","u-size-"+t.size,"u-shape-"+t.shape,"u-mode-"+t.mode+"-"+t.type],"u-tag"]),style:p([_.customStyle]),onClick:_.clickTag},{default:n((()=>[i(c(t.text),1),d(h,{class:"u-icon-wrap",onClick:l[0]||(l[0]=m((()=>{}),["stop"]))},{default:n((()=>[t.closeable?(a(),r(y,{key:0,onClick:_.close,size:"22",color:_.closeIconColor,name:"close",class:"u-close-icon",style:p([_.iconStyle])},null,8,["onClick","color","style"])):f("v-if",!0)])),_:1})])),_:1},8,["class","style","onClick"])):f("v-if",!0)}],["__scopeId","data-v-969b30ce"]]),Fe=oe(g({__name:"picture",props:{picture:{default:""},lazyImg:{default:""}},emits:["preview","share"],setup(e,{emit:l}){const s=(e,l)=>{h({current:l,urls:e})};return(c,m)=>{const p=u(o("u-loading"),be),x=v,g=u(o("u-image"),we),h=u(o("u-icon"),re);return a(),t("div",{class:"preview-picture"},[f("    单张图片    "),Array.isArray(e.picture)?(a(),t(_,{key:1},[f("    多张图片    "),(a(!0),t(_,null,y(e.picture,((t,u)=>(a(),r(x,{class:"image__item relative inline-block",key:u},{default:n((()=>[d(g,{class:"inline-block",width:"280",mode:"widthFix",src:t,onClick:l=>s(e.picture,u)},null,8,["src","onClick"]),d(x,{class:"image__item__icon",onClick:e=>l("share",t)},{default:n((()=>[d(h,{name:"share",color:"#ffffff",size:"34"})])),_:2},1032,["onClick"])])),_:2},1024)))),128))],64)):(a(),r(g,{key:0,src:e.lazyImg,width:"640rpx",height:"640rpx",mode:"aspectFit","border-radius":"0",onClick:m[0]||(m[0]=l=>s([e.picture],0))},{loading:n((()=>[d(x,{class:"flex flex-col justify-center items-center w-[640rpx] h-[640rpx] bg-[#F7F9FD]"},{default:n((()=>[d(p,{mode:"circle",color:c.$theme.primaryColor,size:"40"},null,8,["color"]),d(x,{class:"text-primary text-sm mt-[20rpx]"},{default:n((()=>[i(" 加载中 ")])),_:1})])),_:1})])),_:1},8,["src"]))])}}}),[["__scopeId","data-v-5f66b0f3"]]),Re=oe(g({__name:"success",props:{value:{default:""}},setup(e){const l=b("pageIndex"),r=b("drawForm"),n=b("deleteDrawing"),m=b("drawingHandler"),p=w(),x=k(!1),{copy:v}=he(),g=(e,l)=>{const a=e;a.action="upsample"+l,a.model=e.model,console.log(a),m({drawing:a,isClear:!1})},y=(e,l)=>{const a=e;a.action="variation"+l,a.model=e.model,m({drawing:a,isClear:!1})},h=async e=>{if(!x.value)if(Array.isArray(e.image))uni.$u.toast("已经切片完成了～");else{C({title:"切图中"}),x.value=!0;try{const{getImages:l}=((e,l)=>{const{columns:a,rows:t}=l;if(!e)throw Error("请传入图片地址");if(!a&&!t)throw Error("请传入columns和rows");const s=async(e,l,a)=>{const t=document.createElement("canvas");t.width=e,t.height=l;const s=t.getContext("2d");return s.drawImage(a,0,0,e,l),u(s)},u=e=>{const l=e.canvas.width/a,s=e.canvas.height/t,u=[];for(let r=0;r<t;r++){const t=[];for(let u=0;u<a;u++){const a=o(e,u*l,r*s,l,s);t.push(a)}u.push(...t)}return u},o=(e,l,a,t,s)=>{const u=document.createElement("canvas");u.width=t,u.height=s;const o=e.getImageData(l,a,t,s);return u.getContext("2d").putImageData(o,0,0),u.toDataURL("image/png",1)};return{getImages:()=>new Promise(((l,a)=>{const t=new Image;t.setAttribute("src",e+"?"+(new Date).getTime()),t.setAttribute("crossOrigin",""),t.onload=()=>{l(s(t.width,t.height,t))},t.onerror=e=>{a(e)}}))}})(e.image||e.image_url,{columns:2,rows:2}),a=await l();e.image=a}catch(l){console.log("一键切图失败=>",l)}finally{A(),x.value=!1}}},z=async(e,l)=>{const a=Object.assign({},e);l&&(a.is_base64=1),j("shareSquare",a)};return(m,x)=>{var b,w,k,C,A,j,L;const D=u(o("u-tag"),Ie);return a(),t("div",{class:"success"},[f("    头部操作    "),s("div",{class:"flex justify-between items-center"},[s("div",{class:"success__tag"},"绘画完成"),s("div",{class:"flex items-center"},[s("img",{class:"w-[32rpx] h-[32rpx] ml-[34rpx]",src:V(ne),alt:"复制",onClick:x[0]||(x[0]=l=>(async e=>{await v(e)})(e.value.prompt_desc))},null,8,["src"]),s("img",{class:"w-[32rpx] h-[32rpx] ml-[34rpx]",src:V(ie),alt:"下载",onClick:x[1]||(x[1]=l=>(async e=>{Array.isArray(e.image)?uni.$u.toast("请点击自己想要保存的图片后长按保存～"):ye(e.image)})(e.value))},null,8,["src"]),s("img",{class:"w-[32rpx] h-[32rpx] ml-[34rpx]",src:V(ce),alt:"重新生成",onClick:x[2]||(x[2]=a=>(async e=>{l.value=0,r.prompt=e.prompt,r.image_id="",r.other=e.prompt_other,r.scale=e.scale,r.model=e.model,r.no_content=e.no_content,r.style=e.style,r.quality=e.quality,r.image_base=e.image_base})(e.value))},null,8,["src"]),!(null==(b=e.value.actions)?void 0:b.includes("low_variation"))&&(null==(w=e.value.actions)?void 0:w.length)?(a(),t("img",{key:0,class:"w-[32rpx] h-[32rpx] ml-[34rpx]",src:V("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAHlBMVEVHcExhYWFmZmZlZWVlZWVmZmZlZWVlZWVkZGRlZWWJxh4tAAAACnRSTlMAEXu55f+bWDnQgJjCkQAAASVJREFUeAF1lL1LA0EQxV9UNOVxoGAnYsAyRU4tRTiw9CNPvc4m2AbB3kLBNoX/r7O7t2bnuDdFjt13v5ncfMGsXvBijdImqyv7PaLZ0inHfASmbRD4VAK/JPAV78l5Cdh7kwAsHBKADfbJbo3a5KoAugqH5Cuiw7kDMGMXTlPy3gFo+ByPq/6ZAbS8i+cPPjgA2fd3L2TAhGsnZMBipKCzJPwDFjS92fLFARZ0+WmPneRyC2CPvI2eeOIAHFiaLn/OGFNSACFIbxsHALtZ6CoHlIgDzHFjlzfh0gOmvJ+ex7geKMozAIr6jAFaGHGlgsu/qz5QpkQlMaT9bSztslCytLIZZPvIhpMtKps6j0EzHAM5OHLU5HDKcZYLQK8M1GLJiLX0BxNKrSsJE2OyAAAAAElFTkSuQmCC"),alt:"切片",onClick:x[3]||(x[3]=l=>h(e.value))},null,8,["src"])):f("v-if",!0),V(p).getDrawSquareConfig.is_allow_share?(a(),t("img",{key:1,class:"w-[32rpx] h-[32rpx] ml-[34rpx]",src:V("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAG1BMVEVHcExgYGBmZmZlZWVmZmZlZWVmZmZlZWVmZmbowfqOAAAACXRSTlMAEILV/7hh8ClfHKXyAAABDUlEQVR4AZVUsW6DQAw9GKKMl6FqxlblCyKGzvCSm1sxdMwQiblqhRiRGMpn13eU5fwsNZZY/MSz/Z59Lo/iBe/ekegBDCS/kzxw1cBjAj41UOFylE8DndCUOGsA8G4P/B8oaoNqBi4LKb5Oodstuj8gH/AHODNJSiBcRcRTJuK+Bj4MXRuWfwDaieQj0Zs27eQr4k/s8IsQbeM+5T+spmFUZSs0yw2tXo2o9A4t82ayTDOAWvopETwtzsbb2sWzMwYME91jIWs8EzGq+8rsiMZquVLMhlPuEMsIb1AXdYzbQC9KbA/8onpjRdOODocbuShR4d6L+raALplDqFZzyDmbD4D5ZKQZRyblJuIv5txWGr3pEI4AAAAASUVORK5CYII="),alt:"分享至广场",onClick:x[4]||(x[4]=l=>z(e.value))},null,8,["src"])):f("v-if",!0),s("img",{class:"w-[32rpx] h-[32rpx] ml-[34rpx]",src:V(de),alt:"删除",onClick:x[5]||(x[5]=l=>(async e=>{n([e.id])})(e.value))},null,8,["src"])])]),f("    中部图片    "),s("div",{class:"success__section relative text-sm mt-[15px]"},[s("div",{class:"image-bg"},[d(Fe,{picture:e.value.image||e.value.image_url,"lazy-img":e.value.thumbnail,onShare:x[6]||(x[6]=l=>z(e.value,l))},null,8,["picture","lazy-img"])]),s("div",{class:"image-content"},[e.value.prompt_desc?(a(),t("p",{key:0,class:"text-white line-clamp-2"},c(e.value.prompt),1)):f("v-if",!0)])]),f("    底部信息    "),s("div",{class:"mt-[20px] success__footer"},[e.value.fail_reason&&2==e.value.censor_status?(a(),t("div",{key:0,class:"h-[110rpx]"},[s("p",{class:"line-clamp-2",onClick:x[7]||(x[7]=l=>V(v)(e.value.fail_reason))},c(e.value.fail_reason),1)])):(a(),t(_,{key:1},[s("div",null,[s("span",null,"放大图片"),!(null==(k=e.value.actions)?void 0:k.includes("low_variation"))&&(null==(A=null==(C=e.value)?void 0:C.actions)?void 0:A.length)?(a(),t(_,{key:0},[s("span",{class:"opt-btn",onClick:x[8]||(x[8]=l=>g(e.value,1))},"左上"),s("span",{class:"opt-btn",onClick:x[9]||(x[9]=l=>g(e.value,2))},"右上"),s("span",{class:"opt-btn",onClick:x[10]||(x[10]=l=>g(e.value,3))},"左下"),s("span",{class:"opt-btn",onClick:x[11]||(x[11]=l=>g(e.value,4))},"右下")],64)):(a(),t(_,{key:1},[i(" - ")],64))]),s("div",{class:"mt-[15px]"},[s("span",null,"变体图片"),!(null==(j=e.value.actions)?void 0:j.includes("low_variation"))&&(null==(L=e.value.actions)?void 0:L.length)?(a(),t(_,{key:0},[s("span",{class:"opt-btn",onClick:x[12]||(x[12]=l=>y(e.value,1))},"左上"),s("span",{class:"opt-btn",onClick:x[13]||(x[13]=l=>y(e.value,2))},"右上"),s("span",{class:"opt-btn",onClick:x[14]||(x[14]=l=>y(e.value,3))},"左下"),s("span",{class:"opt-btn",onClick:x[15]||(x[15]=l=>y(e.value,4))},"右下")],64)):(a(),t(_,{key:1},[i(" - ")],64))])],64)),s("div",{class:"flex justify-between items-center mt-[15px] text-[#999999] text-base"},[s("span",null,"时间："+c(e.value.create_time),1),d(D,{text:e.value.draw_model,mode:"light",size:"mini"},null,8,["text"])])])])}}}),[["__scopeId","data-v-d019707c"]]),Ue=oe(g({__name:"fail",props:{value:{default:{}}},setup(e){const l=b("pageIndex"),t=b("drawForm"),m=b("deleteDrawing");return(p,x)=>{const g=v,_=z,y=u(o("u-tag"),Ie);return a(),r(g,{class:"fail-box"},{default:n((()=>[f("    头部操作    "),d(g,{class:"flex justify-between items-center"},{default:n((()=>[d(g,{class:"fail-box__tag"},{default:n((()=>[i("绘画失败")])),_:1}),d(g,{class:"flex items-center"},{default:n((()=>[d(_,{class:"w-[32rpx] h-[32rpx] ml-[34rpx] cursor-pointer",src:V(ce),alt:"重新生成",onClick:x[0]||(x[0]=a=>(async e=>{try{l.value=0,t.prompt=e.prompt,t.image_id="",t.other=e.prompt_other,t.scale=e.scale,t.model=e.model,t.style=e.style,t.quality=e.quality,t.no_content=e.no_content,t.image_base=e.image_base}catch(a){console.log("重新生成",a)}})(e.value))},null,8,["src"]),d(_,{class:"w-[32rpx] h-[32rpx] ml-[34rpx]",src:V(de),alt:"删除",onClick:x[1]||(x[1]=l=>V(m)([e.value.id]))},null,8,["src"])])),_:1})])),_:1}),d(_,{class:"w-[300rpx] h-[300rpx] mt-[100rpx]",src:V(me)},null,8,["src"]),d(g,{class:"text-xl mt-[40rpx]"},{default:n((()=>[i(" 绘画失败 ")])),_:1}),d(g,{class:"mt-[10px] text-base text-[#999999] px-[30px] h-[320rpx] break-words"},{default:n((()=>[i(" 错误信息："+c(e.value.fail_reason),1)])),_:1}),s("div",{class:"flex justify-between items-center mt-[auto] text-[#999999] text-base"},[s("span",null,"时间："+c(e.value.create_time),1),d(y,{text:e.value.draw_model,mode:"light",size:"mini"},null,8,["text"])])])),_:1})}}}),[["__scopeId","data-v-b688b75a"]]),Te=oe(g({__name:"index",props:{value:{default:""},status:{default:0}},setup:e=>(l,s)=>(a(),t("div",{class:"card-container"},[f("  生成中  "),1===e.status||0===e.status?(a(),r(Se,{key:0})):f("v-if",!0),f("  成功  "),3===e.status?(a(),r(Re,{key:1,value:e.value},null,8,["value"])):f("v-if",!0),f("  失败  "),2===e.status?(a(),r(Ue,{key:2,value:e.value},null,8,["value"])):f("v-if",!0)]))}),[["__scopeId","data-v-2bfcc5b9"]]),Ze=g({__name:"paging",props:{i:{default:0},index:{default:0},status:{default:3},setTaskRecordFunc:{default:()=>{}}},emits:["click"],setup(e,{emit:s}){const i=e,c=L(null),m=k([]);D((()=>i.i),(async()=>{var e;i.i==i.index&&(await S(),null==(e=c.value)||e.reload())}),{immediate:!0});const p=async(e,a)=>{try{const{lists:s}=await(t={status:i.status,page_no:e,page_size:a},l.get({url:"/draw_records/records",data:t},{ignoreCancel:!0}));i.i==i.index&&i.setTaskRecordFunc({reload:c.value,lists:s}),c.value.complete(s)}catch(s){console.log("报错=>",s),c.value.complete(!1)}var t};return(l,s)=>{const i=v,f=u(o("z-paging"),ue);return a(),r(f,{"auto-show-back-to-top":"",auto:e.i==e.index,ref_key:"paging",ref:c,modelValue:m.value,"onUpdate:modelValue":s[0]||(s[0]=e=>m.value=e),"data-key":e.i,fixed:!1,height:"100%","auto-clean-list-when-reload":!0,"auto-scroll-to-top-when-reload":!1,"empty-view-img":V(pe),"empty-view-text":"暂无记录~",onQuery:p},{default:n((()=>[d(i,{class:"px-[30rpx]"},{default:n((()=>[(a(!0),t(_,null,y(m.value,((e,l)=>(a(),r(Te,{key:l,value:e,status:e.status},null,8,["value","status"])))),128))])),_:1})])),_:1},8,["auto","modelValue","data-key","empty-view-img"])}}}),Ee=g({__name:"share-square",emits:["success","close"],setup(e,{expose:l,emit:s}){w();const r=k(!1),m=k(!1),p=k([]),f=I({base64:"",is_base64:"",prompts:"",category_name:"",category_id:"",draw_records_id:""}),{lockFn:x,isLock:g}=je((async e=>{await Ae(f),r.value=!1,s("success"),s("close")})),y=e=>{f.category_id=e[0].value,f.category_name=e[0].label},h=()=>{s("close")};return l({open:e=>{(async()=>{try{const e=await Ce();e.shift(),p.value=e}catch(e){console.log("获取绘画分类失败=>",e)}})(),r.value=!0,f.base64=e.base64,f.is_base64=e.is_base64,f.prompts=e.prompt_en||e.prompt,f.draw_records_id=e.id}}),(e,l)=>{const s=v,b=u(o("u-button"),te),w=u(o("u-popup"),ke),k=u(o("u-select"),Ve);return a(),t(_,null,[d(w,{modelValue:r.value,"onUpdate:modelValue":l[1]||(l[1]=e=>r.value=e),mode:"center","border-radius":"14",duration:"16",onClose:h},{default:n((()=>[d(s,{class:"w-[650rpx]"},{default:n((()=>[d(s,{class:"p-[30rpx] text-center text-lg font-medium"},{default:n((()=>[i("分享至广场")])),_:1}),d(s,{class:"h-[300rpx] p-[30rpx]"},{default:n((()=>[d(s,{class:"rounded-[12rpx] p-[20rpx] text-content bg-[#eeeeee]",onClick:l[0]||(l[0]=e=>m.value=!0)},{default:n((()=>[i(c(f.category_name?f.category_name:"全部"),1)])),_:1})])),_:1}),d(s,{class:"flex justify-center mt-[30rpx] pb-[20rpx]"},{default:n((()=>[d(b,{type:"primary",shape:"circle",customStyle:{width:"220rpx"},loading:V(g),onClick:V(x)},{default:n((()=>[i(" 确定 ")])),_:1},8,["loading","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),d(k,{modelValue:m.value,"onUpdate:modelValue":l[2]||(l[2]=e=>m.value=e),list:p.value,valueName:"id",labelName:"name",confirmColor:e.$theme.primaryColor,onConfirm:y},null,8,["modelValue","list","confirmColor"])],64)}}}),Me=oe(g({__name:"index",setup(e){const l=F(),m=b("pageIndex"),p=b("taskLists"),g=b("taskIndex"),h=b("setTaskRecordFunc"),w=k(!1),C=L(null),A=k([]);R("shareSquare",(e=>{console.log("emit share"),j(e)}));const j=async e=>{var l;if(A.value.includes(e.id)||e.is_square){if((await U({title:"温馨提示",content:"该图片已分享过，是否确认重复分享？"})).cancel)return}w.value=!0,await S(),null==(l=C.value)||l.open(e)};return T((()=>{Z("shareSquare")})),E((()=>{Z("shareSquare")})),(e,b)=>{const k=v,A=z,j=u(o("u-button"),te),L=u(o("router-navigate"),se);return a(),t(_,null,[d(k,{class:"h-full flex flex-col"},{default:n((()=>[s("div",{class:"task-lists"},[(a(!0),t(_,null,y(V(p),((e,l)=>(a(),t("div",{key:l,class:x(["task-item",{"task-item--active":e.value===V(g)}]),onClick:l=>g.value=e.value},c(e.name),11,["onClick"])))),128))]),d(k,{class:"flex-1 min-h-0"},{default:n((()=>[V(l).isLogin?(a(),r(k,{key:0,class:"h-full relative"},{default:n((()=>[(a(!0),t(_,null,y(V(p),((e,l)=>M((a(),r(k,{class:"h-full",key:l},{default:n((()=>[d(Ze,{index:e.value,i:V(g),status:e.value,setTaskRecordFunc:V(h)},null,8,["index","i","status","setTaskRecordFunc"])])),_:2},1024)),[[N,e.value===V(g)]]))),128))])),_:1})):(a(),r(k,{key:1,class:"h-full flex justify-center pt-[200rpx]"},{default:n((()=>[d(L,{class:"text-center",to:"/pages/login/login"},{default:n((()=>[d(A,{class:"w-[300rpx] h-[300rpx]",src:V(fe)},null,8,["src"]),d(k,{class:"mt-[20rpx] mb-[50rpx] text-base text-muted"},{default:n((()=>[i(" 暂无查看权限，请登录账号后查看 ")])),_:1}),d(j,{type:"primary","custom-style":{width:"345rpx",height:"82rpx",fontSize:"32rpx"},shape:"circle"},{default:n((()=>[i(" 点击登录 ")])),_:1})])),_:1})])),_:1}))])),_:1}),d(k,{class:"p-[20rpx]",style:{"box-shadow":"0 0 10rpx rgba(0, 0, 0, 0.2)"}},{default:n((()=>[d(k,{class:"flex w-full h-[82rpx] bg-[#f0f2f2] rounded-[999px] text-[#333333]"},{default:n((()=>[d(k,{class:"w-[50%]"},{default:n((()=>[d(j,{type:"primary","custom-style":{width:"100%",height:"82rpx",fontSize:"30rpx"},shape:"circle"},{default:n((()=>[i(" 生成记录 ")])),_:1})])),_:1}),d(k,{class:"w-[50%] h-[82rpx] flex justify-center items-center",onClick:b[0]||(b[0]=e=>m.value=0)},{default:n((()=>[i(" 立即生成 ")])),_:1})])),_:1})])),_:1})])),_:1}),w.value?(a(),r(Ee,{key:0,ref_key:"shareRef",ref:C,onClose:b[1]||(b[1]=e=>w.value=!1)},null,512)):f("v-if",!0)],64)}}}),[["__scopeId","data-v-de5c0576"]]),Ne=oe(g({__name:"keyword-suggestion",props:{modelValue:{default:""}},emits:["update:modelValue"],setup(e,{expose:s,emit:m}){const p=e,g=k(!1),h=k(0),b=k([]),w=k({prompt:[],cate_prompt:[]}),V=k([]);O((()=>{""==p.modelValue&&(V.value=[])}));const C=e=>{const l=V.value.findIndex((l=>l==e));l>=0?V.value.splice(l,1):V.value.push(e)},A=e=>{h.value=e,L()},j=async()=>{try{b.value=await l.get({url:"/draw_prompt/category"}),await L()}catch(e){console.log("获取关键词分类错误",e)}},L=async()=>{try{w.value=await(e={id:b.value[h.value].id},l.get({url:"/draw_prompt/prompt",data:e}))}catch(a){console.log("获取关键词错误",a)}var e};return s({open:()=>{g.value=!0,j()}}),(e,l)=>{const s=v,k=u(o("u-tabs"),ze),j=z,L=q,D=B,S=u(o("u-popup"),ke);return a(),r(S,{modelValue:g.value,"onUpdate:modelValue":l[2]||(l[2]=e=>g.value=e),mode:"center",closeable:!0,"border-radius":"20","z-index":99999},{default:n((()=>[d(s,{class:"w-[640rpx] h-[980rpx]"},{default:n((()=>[d(s,{class:"p-[30rpx] text-lg text-main text-center"},{default:n((()=>[i("关键词推荐")])),_:1}),b.value.length?(a(),r(k,{key:0,list:b.value,"is-scroll":!0,"active-color":e.$theme.primaryColor,height:"80rpx","font-size":"28rpx",current:h.value,onChange:A},null,8,["list","active-color","current"])):f("v-if",!0),d(L,{class:"h-[700rpx]","scroll-y":!0},{default:n((()=>[w.value.prompt.length||w.value.cate_prompt.length?(a(),t(_,{key:0},[(a(!0),t(_,null,y(w.value.cate_prompt,((e,l)=>(a(),r(s,{key:l,class:"keyword-container"},{default:n((()=>[d(s,{class:"keyword-title text-base text-[#666]"},{default:n((()=>[i(c(e.name)+"("+c(null==e?void 0:e.prompt.length)+") ",1)])),_:2},1024),(a(!0),t(_,null,y(e.prompt,(e=>(a(),r(s,{key:e.text,class:x(["keyword-item",{"keyword-item-active":V.value.includes(e.prompt_en)}]),onClick:l=>C(e.prompt_en)},{default:n((()=>[i(c(e.prompt),1)])),_:2},1032,["class","onClick"])))),128))])),_:2},1024)))),128)),w.value.prompt.length?(a(),r(s,{key:0,class:"keyword-container"},{default:n((()=>[w.value.cate_prompt.length?(a(),r(s,{key:0,class:"keyword-title text-base text-[#666]"},{default:n((()=>[i(" 其它("+c(w.value.prompt.length)+") ",1)])),_:1})):f("v-if",!0),(a(!0),t(_,null,y(w.value.prompt,(e=>(a(),r(s,{key:e.text,class:x(["keyword-item",{"keyword-item-active":V.value.includes(e.prompt_en)}]),onClick:l=>C(e.prompt_en)},{default:n((()=>[i(c(e.prompt),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})):f("v-if",!0)],64)):(a(),r(s,{key:1,class:"h-full flex flex-col justify-center items-center"},{default:n((()=>[d(j,{class:"w-[300rpx] h-[300rpx]",src:pe}),d(s,{class:"text-muted text-center"},{default:n((()=>[i("暂无关键词推荐")])),_:1})])),_:1}))])),_:1}),d(s,{class:"flex mt-[20rpx] px-[30rpx]"},{default:n((()=>[d(D,{class:"footer_btn full_btn",onClick:l[0]||(l[0]=e=>(()=>{if(g.value=!1,""==p.modelValue.trim())m("update:modelValue",V.value.join(","));else{const e=p.modelValue+","+V.value.join(",");m("update:modelValue",e)}V.value=[]})())},{default:n((()=>[i(" 添加到文本描述 ")])),_:1}),d(D,{class:"footer_btn plain_btn ml-[20rpx]",onClick:l[1]||(l[1]=e=>(g.value=!1,m("update:modelValue",V.value.join(",")+","),void(V.value=[])))},{default:n((()=>[i(" 替换当前文本 ")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-7bc73663"]]),Oe=oe(g({__name:"generation-picker",props:{balance:{default:0},modelValue:{default:""}},emits:["update:modelValue","update:balance"],setup(e,{expose:t,emit:s}){const n=e,i=I({current:0,modelList:[]});D((()=>n.modelValue),(e=>{const l=i.modelList.findIndex((l=>l.model===e));i.current=-1==l?0:l}),{immediate:!1});const c=async()=>{try{const e=await l.get({url:"/draw/modelConfig"});i.modelList=e;const a=e.find((e=>e.default))||e[0],t=e.findIndex((e=>e.default));d("-1"==t?0:t),s("update:balance",a.balance),s("update:modelValue",a.model),console.log(e)}catch(e){console.log("获取绘画模型失败=>",e)}},d=e=>{i.current=e,s("update:balance",i.modelList[e].balance),s("update:modelValue",i.modelList[e].model)};return c(),t({getDrawModel:c}),(e,l)=>{const t=u(o("u-tabs"),ze);return i.modelList.length?(a(),r(t,{key:0,list:i.modelList,"is-scroll":!0,modelValue:i.current,"onUpdate:modelValue":l[0]||(l[0]=e=>i.current=e),"active-color":e.$theme.primaryColor,"bg-color":"transparent",barStyle:{background:e.$theme.primaryColor},onChange:d},null,8,["list","modelValue","active-color","barStyle"])):f("v-if",!0)}}}),[["__scopeId","data-v-ad396bc0"]]),qe=oe(g({__name:"prompt-txt2img",props:{modelValue:{default:""},keydownRef:{default:{}}},emits:["update:modelValue"],setup(e,{emit:s}){const c=e,p=w(),x=H({get:()=>c.modelValue,set:e=>{s("update:modelValue",e)}}),{isLock:g,lockFn:y}=je((async()=>{try{if(""==x.value.trim())return void uni.$u.toast("请输入描述词");const{translate:a}=await(e={prompt:x.value},l.get({url:"/draw_prompt/translate",data:e}));s("update:modelValue",a)}catch(a){console.log("翻译失败=>",a)}var e}));return(l,s)=>{const c=P,h=v,b=u(o("u-loading"),be),w=z,k=u(o("u-icon"),re),C=u(o("l-textarea"),xe);return a(),t(_,null,[f("    描述推荐    "),d(h,{class:"flex justify-between"},{default:n((()=>[d(h,{class:"text-base"},{default:n((()=>[d(c,{class:"font-medium"},{default:n((()=>[i(" 文本描述 ")])),_:1}),d(c,{class:"text-error"},{default:n((()=>[i("*")])),_:1})])),_:1})])),_:1}),f("    关键词输入    "),d(h,{class:"mt-[24rpx]"},{default:n((()=>[d(C,{modelValue:V(x),"onUpdate:modelValue":s[2]||(s[2]=e=>G(x)?x.value=e:null),maxlength:"1024",rows:4,"show-word-limit":!1,"custom-class":{paddingBottom:"60rpx"},placeholder:"输入英文描述词，生成效果会更好；描述词越详细，生成的图片效果更加真实哦～~"},{"length-suffix":n((()=>[d(h,{class:"length-suffix justify-end text-sm"},{default:n((()=>{var t,u;return[d(h,{class:"text-primary",onClick:s[0]||(s[0]=l=>{var a;return null==(a=e.keydownRef)?void 0:a.open()})},{default:n((()=>[i(" 描述词推荐 ")])),_:1}),2==(null==(u=null==(t=V(p))?void 0:t.getDrawConfig)?void 0:u.translate_type)?(a(),r(h,{key:0,class:"ml-[40rpx] text-muted hover:text-primary",loading:V(g),onClick:m(V(y),["stop"])},{default:n((()=>[V(g)?(a(),r(b,{key:0,mode:"flower",color:l.$theme.primaryColor,size:"28"},null,8,["color"])):(a(),r(w,{key:1,class:"w-[26rpx] h-[26rpx]",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAFVBMVEVHcEyYmJiZmZmYmJiZmZmampqZmZmFlyKXAAAAB3RSTlMAH3ZC/7vnZ6zrigAAAKZJREFUeAHNk7sOgkAURPchvQX0ELE38VGbdaDGqD9g+P9v8JI1Fu7cwqzFnvYkdyfMYMrBbhRR48pFj3FHxQoIVHgAN2oqMS01B2BYU3MHnlQ4OdZR00DL3L8zuxkpU8yRctFE0E51OR0VhnsQlhbrn79VxcSyOysth/0Xn5YnmuuojklaHqjwcwyY0qjPyLGRLtNL5rO2TP5nmJPyvLHb9s+1ZfACuYhGWUAa+wgAAAAASUVORK5CYII="})),d(c,{class:"ml-[10rpx]"},{default:n((()=>[i("翻译成英文")])),_:1})])),_:1},8,["loading","onClick"])):f("v-if",!0),d(h,{class:"text-muted hover:text-primary ml-[40rpx]",onClick:s[1]||(s[1]=m((e=>x.value=""),["stop"]))},{default:n((()=>[d(k,{name:"trash"}),d(c,null,{default:n((()=>[i("清空")])),_:1})])),_:1})]})),_:1})])),_:1},8,["modelValue"])])),_:1})],64)}}}),[["__scopeId","data-v-aeebb77f"]]),Be=g({__name:"example-prompt",props:{modelValue:{default:""}},emits:["update:modelValue"],setup(e,{expose:s,emit:p}){const f=k([]),x=async()=>{try{f.value=await l.get({url:"/draw_prompt/example"})}catch(e){console.log("请求绘画示例失败=>",e)}};return x(),s({getDrawingExample:x}),(e,l)=>{const s=u(o("u-icon"),re),g=P,h=v;return a(),r(h,{class:"flex justify-between mt-[20rpx] text-base"},{default:n((()=>[d(h,{class:"flex items-center text-muted",onClick:x},{default:n((()=>[d(h,{class:"flex items-center text-[#8e8e8e] hover:text-primary"},{default:n((()=>[d(s,{name:"reload"}),d(g,{class:"text-muted ml-[10rpx]"},{default:n((()=>[i("随便试试")])),_:1})])),_:1}),d(h,{class:"ml-[10rpx] text-black truncate w-[500rpx]"},{default:n((()=>[(a(!0),t(_,null,y(f.value,((e,l)=>(a(),r(g,{class:"ml-[20rpx]",key:l,onClick:m((l=>{return a=e.prompt_en,void p("update:modelValue",a);var a}),["stop"])},{default:n((()=>[i(c(e.prompt),1)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})])),_:1})}}}),He=oe(g({__name:"reference-image",props:{modelValue:{default:""}},emits:["update:modelValue"],setup(e,{emit:l}){const s=async()=>{if(!F().isLogin)return K({url:"/pages/login/login"});Q({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:e=>{c(e.tempFilePaths[0])}})},c=async e=>{C({title:"上传中"});try{const a=await Y(e,{type:"draw"});l("update:modelValue",a.uri),A()}catch(a){A(),uni.$u.toast(a),console.log("上传图片失败",a)}};return(c,p)=>{const x=v,g=z,y=u(o("u-icon"),re);return a(),t(_,null,[f("    上传参考图    "),d(x,{class:"mt-[40rpx]"},{default:n((()=>[d(x,{class:"text-base font-medium"},{default:n((()=>[i("上传参考图")])),_:1}),d(x,{class:"uploader mt-[20rpx] flex justify-center items-center",onClick:s},{default:n((()=>[f("    没有图片的时候    "),e.modelValue?(a(),t(_,{key:1},[f("    有图片的时候    "),d(x,{class:"w-full h-full relative text-center has_image",onClick:p[1]||(p[1]=m((()=>{}),["stop"]))},{default:n((()=>[d(y,{class:"has_img_delete",name:"close-circle-fill",color:"#ffffff",size:"40",onClick:p[0]||(p[0]=m((e=>l("update:modelValue","")),["stop"]))}),d(g,{class:"w-full h-full",src:e.modelValue,mode:"aspectFit"},null,8,["src"]),d(x,{class:"has_img_btn",onClick:s},{default:n((()=>[i(" 换图 ")])),_:1})])),_:1})],2112)):(a(),r(x,{key:0,class:"flex flex-col justify-center items-center"},{default:n((()=>[d(g,{class:"w-[72rpx] h-[72rpx] mb-[12rpx]",src:ve}),d(x,{class:"text-muted"},{default:n((()=>[i("点击上传参考图")])),_:1})])),_:1}))])),_:1})])),_:1})],2112)}}}),[["__scopeId","data-v-566a63f0"]]),Ge=g({__name:"negative-prompt",props:{modelValue:{default:""}},emits:["update:modelValue"],setup(e,{emit:l}){const t=e,s=H({get:()=>t.modelValue,set:e=>{l("update:modelValue",e)}});return(e,l)=>{const t=v,c=u(o("u-input"),Le);return a(),r(t,{class:"mt-[20rpx]"},{default:n((()=>[d(t,{class:"text-base font-medium mb-[20rpx]"},{default:n((()=>[i("忽略的元素")])),_:1}),d(c,{type:"text","cursor-spacing":120,modelValue:V(s),"onUpdate:modelValue":l[0]||(l[0]=e=>G(s)?s.value=e:null),maxlength:"200",placeholder:"输入图片中不想出现的词，例如tree、fish等",customStyle:{padding:"0 20rpx",borderRadius:"14rpx",backgroundColor:"#f5f5f5"}},null,8,["modelValue"])])),_:1})}}}),Pe=g({__name:"other-prompt",props:{modelValue:{default:""}},emits:["update:modelValue"],setup(e,{emit:l}){const t=e,s=H({get:()=>t.modelValue,set:e=>{l("update:modelValue",e)}});return(e,l)=>{const t=v,c=u(o("u-input"),Le);return a(),r(t,{class:"mt-[20rpx]"},{default:n((()=>[d(t,{class:"text-base font-medium mb-[20rpx]"},{default:n((()=>[i("其它参数")])),_:1}),d(c,{type:"text","cursor-spacing":120,modelValue:V(s),"onUpdate:modelValue":l[0]||(l[0]=e=>G(s)?s.value=e:null),maxlength:"200",placeholder:"请输入后缀参数",customStyle:{padding:"0 20rpx",borderRadius:"14rpx",backgroundColor:"#f5f5f5"}},null,8,["modelValue"])])),_:1})}}}),Ke=oe(g({__name:"picture-size",props:{modelValue:{default:"1:1"}},emits:["update:modelValue"],setup(e,{emit:l}){const s=e,u=H({get:()=>s.modelValue,set:e=>{l("update:modelValue",e)}}),o=I({lists:[{name:"头像图",scale:"1:1",style:"width: 40rpx; height: 40rpx"},{name:"手机壁纸",scale:"1:2",style:"width: 22rpx; height: 40rpx"},{name:"文章配图",scale:"4:3",style:"width: 40rpx; height: 30rpx"},{name:"宣传海报",scale:"9:16",style:"width: 26rpx; height: 40rpx"},{name:"媒体配图",scale:"3:4",style:"width: 30rpx; height: 40rpx"},{name:"电脑壁纸",scale:"16:9",style:"width: 40rpx; height: 24rpx"},{name:"横版名片",scale:"3:2",style:"width: 40rpx; height: 28rpx"},{name:"小红书图",scale:"2:3",style:"width: 26rpx; height: 40rpx"}]});return(e,l)=>{const s=v;return a(),r(s,{class:"mt-[40rpx]"},{default:n((()=>[d(s,{class:"text-base font-medium"},{default:n((()=>[i("图片尺寸")])),_:1}),d(s,{class:"flex justify-between flex-wrap"},{default:n((()=>[(a(!0),t(_,null,y(o.lists,((e,l)=>(a(),r(s,{key:l,class:x(["picture-size mt-[20rpx] rounded-[8rpx] text-center",{"picture-size-active":V(u)==e.scale}]),onClick:l=>u.value=e.scale},{default:n((()=>[d(s,{class:"flex justify-center items-center mt-[30rpx] h-[40rpx]"},{default:n((()=>[d(s,{class:"rect",style:p(e.style)},null,8,["style"])])),_:2},1024),d(s,{class:"text-xl mt-[8rpx] size-scale"},{default:n((()=>[i(c(e.scale),1)])),_:2},1024),d(s,{class:"text-base mt-[4px] size-name"},{default:n((()=>[i(c(e.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})}}}),[["__scopeId","data-v-71a00a4c"]]),Qe=oe(g({__name:"model-picker",props:{version:{default:""},style:{default:"default"}},emits:["update:version","update:style"],setup(e,{emit:l}){const m=w(),g=k("动漫"),h=k("5.2"),b=J.baseUrl,C=k("mj"),A=[{name:"Midjourney",value:"mj",desc:"真实感强",background:b+"resource/image/adminapi/default/draw/mj.png"},{name:"Niji",value:"niji",desc:"卡通动漫",background:b+"resource/image/adminapi/default/draw/nj.png"}],j=e=>{var a;C.value=e;const t=null==(a=null==m?void 0:m.getDrawConfig)?void 0:a.mj_version[e];h.value=t[Object.keys(t)[0]],l("update:version",Object.keys(t)[0])};return j("mj"),l("update:style","default"),(e,b)=>{const w=P,k=v,z=u(o("u-icon"),re);return a(),t(_,null,[d(k,{class:"flex justify-between mt-[20rpx]"},{default:n((()=>[d(k,{class:"text-base"},{default:n((()=>[d(w,{class:"font-medium"},{default:n((()=>[i(" 模型选择 ")])),_:1})])),_:1})])),_:1}),f("    模型    "),d(k,{class:"flex mt-[10rpx]"},{default:n((()=>[(a(),t(_,null,y(A,(e=>d(k,{key:e.name,class:x(["model-item",{"model-item_active":C.value===e.value}]),"hover-class":"none",onClick:l=>j(e.value)},{default:n((()=>[d(k,{class:"model-item-bg",style:p({"background-image":`url(${e.background})`})},{default:n((()=>[s("span",{class:"text-base"},c(e.name),1),s("span",{class:"text-xs"},c(e.desc),1)])),_:2},1032,["style"])])),_:2},1032,["class","onClick"]))),64))])),_:1}),f("    版本选择    "),d(k,{class:"mt-[20rpx] flex items-center"},{default:n((()=>[d(k,{class:"mr-[10px] text-base font-medium"},{default:n((()=>[i("版本选择")])),_:1}),d(ge,{mode:"up"},{default:n((()=>[d(k,{class:"drop-down-input"},{default:n((()=>[d(w,null,{default:n((()=>[i(c(h.value||"请选择版本"),1)])),_:1}),d(z,{name:"arrow-down"})])),_:1})])),menu:n((()=>[d(k,{class:"w-full"},{default:n((()=>{var e,s;return[(a(!0),t(_,null,y(null==(s=null==(e=V(m))?void 0:e.getDrawConfig)?void 0:s.mj_version[C.value],((e,t)=>(a(),r(k,{key:e,class:"py-[14rpx] px-[30rpx]",onClick:a=>{h.value=e,l("update:version",t)}},{default:n((()=>[i(c(e),1)])),_:2},1032,["onClick"])))),128))]})),_:1})])),_:1})])),_:1}),f("    风格选择    "),"niji"===C.value?(a(),r(k,{key:0,class:"mt-[20rpx] flex items-center"},{default:n((()=>[d(k,{class:"mr-[10px] text-base"},{default:n((()=>[i("风格选择")])),_:1}),d(ge,{mode:"up"},{default:n((()=>[d(k,{class:"drop-down-input"},{default:n((()=>[d(w,null,{default:n((()=>[i(c(g.value||"请选择风格"),1)])),_:1}),d(z,{name:"arrow-down"})])),_:1})])),menu:n((()=>[d(k,{class:"w-full"},{default:n((()=>{var e,s;return[(a(!0),t(_,null,y(null==(s=null==(e=V(m))?void 0:e.getDrawConfig)?void 0:s.mj_style,((e,t)=>(a(),r(k,{key:e,class:"py-[14rpx] px-[30rpx]",onClick:a=>{g.value=e,l("update:style",t)}},{default:n((()=>[i(c(e),1)])),_:2},1032,["onClick"])))),128))]})),_:1})])),_:1})])),_:1})):f("v-if",!0)],64)}}}),[["__scopeId","data-v-f8e1b686"]]),Ye=oe(g({__name:"disclaimer-modal",props:{content:{default:""}},setup(e){const l=k(!1),s=k("unactive-modal"),p=()=>{l.value=!0,setTimeout((()=>{s.value="active-modal"}))},g=()=>{s.value="unactive-modal",setTimeout((()=>{l.value=!1}),300)};return(y,h)=>{const b=v,w=u(o("u-button"),te);return a(),t(_,null,[d(b,{class:"disclaimer-trigger",onClick:p},{default:n((()=>[W(y.$slots,"default",{},void 0,!0)])),_:3}),l.value?(a(),r(b,{key:0,class:"disclaimer-container"},{default:n((()=>[d(b,{class:x(["disclaimer-mask",s.value]),onClick:g},null,8,["class"]),d(b,{class:x(["disclaimer-content",s.value])},{default:n((()=>[d(b,{class:"text-center text-xl font-medium"},{default:n((()=>[i(" 免责声明 ")])),_:1}),d(b,{class:"py-[30rpx]"},{default:n((()=>[i(c(e.content),1)])),_:1}),d(b,{class:"mt-[20rpx]"},{default:n((()=>[d(w,{type:"primary","custom-style":{height:"82rpx",fontSize:"30rpx",margin:"0"},shape:"circle",onClick:m(g,["stop"])},{default:n((()=>[i(" 确认 ")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["class"])])),_:1})):f("v-if",!0)],64)}}}),[["__scopeId","data-v-aab182a1"]]),Je=oe(g({__name:"yj-model-picker",props:{data:{default:{cartoon:[],common:[],reality:[]}},modelValue:{default:{engine:"",style:"default"}}},emits:["update:modelValue"],setup(e,{emit:l}){const s=e,u=H({get:()=>s.modelValue,set:e=>{l("update:modelValue",e)}}),o=J.baseUrl,m=k("common"),g=[{name:"通用模型",value:"common",background:o+"resource/image/adminapi/default/draw/yj-ty.png"},{name:"动漫模型",value:"cartoon",background:o+"resource/image/adminapi/default/draw/yj-dm.png"},{name:"现实模型",value:"reality",background:o+"resource/image/adminapi/default/draw/yj-xs.png"}],h=(e,l)=>{u.value.engine=e,u.value.style=l};return h("default_dreamer_diffusion",""),(l,o)=>{const b=P,w=v;return a(),t(_,null,[d(w,{class:"flex justify-between mt-[20rpx]"},{default:n((()=>[d(w,{class:"text-base"},{default:n((()=>[d(b,{class:"font-medium"},{default:n((()=>[i(" 模型选择 ")])),_:1})])),_:1})])),_:1}),f("    模型    "),d(w,{class:"flex mt-[10rpx]"},{default:n((()=>[(a(),t(_,null,y(g,(e=>d(w,{key:e.name,class:x(["model-item model-item_model",{"model-item_active":m.value===e.value}]),"hover-class":"none",onClick:l=>(e=>{m.value=e;const l=s.data[e][0];h(l.engine,l.value)})(e.value)},{default:n((()=>[d(w,{class:"model-item-bg",style:p({"background-image":`url(${e.background})`})},{default:n((()=>[d(w,{class:"h-[70rpx] text-center leading-[80rpx]"},{default:n((()=>[f("                    <el-icon"),f('                        v-if="currentModel === item.value"'),f('                        color="#ffffff"'),f('                        size="22"'),f("                    >"),f("                        <CircleCheck />"),f("                    </el-icon>")])),_:1}),d(w,{class:"text-base w-full text-center h-[90rpx] leading-[120rpx]",style:{background:"linear-gradient(180deg, transparent, #000)"}},{default:n((()=>[i(c(e.name),1)])),_:2},1024)])),_:2},1032,["style"])])),_:2},1032,["class","onClick"]))),64))])),_:1}),d(w,{class:"flex justify-between mt-[20rpx]"},{default:n((()=>[d(w,{class:"text-base"},{default:n((()=>[d(b,{class:"font-medium"},{default:n((()=>[i(" 风格选择 ")])),_:1})])),_:1})])),_:1}),f("    风格选择    "),d(w,{class:"mt-[5px]"},{default:n((()=>[(a(!0),t(_,null,y(e.data[m.value],((e,l)=>(a(),r(w,{key:l,class:x(["model-item model-item_style !w-[345rpx] !h-[260rpx] inline-block",{"model-item_active":V(u).engine===e.engine&&V(u).style===e.value}]),onClick:l=>h(e.engine,e.value)},{default:n((()=>[d(w,{class:"model-item-bg",style:p({"background-image":`url(${e.poster})`})},{default:n((()=>[d(w,{class:"h-full flex justify-center items-center"},{default:n((()=>[f("                    <el-icon"),f('                        v-if="value.engine === item.engine"'),f('                        color="#ffffff"'),f('                        size="26"'),f("                    >"),f("                        <CircleCheck />"),f("                    </el-icon>")])),_:1}),d(w,{class:"text-sm w-full h-[140rpx] flex items-center justify-center",style:{background:"linear-gradient(180deg, transparent, #000)"}},{default:n((()=>[i(c(e.text),1)])),_:2},1024)])),_:2},1032,["style"])])),_:2},1032,["class","onClick"])))),128))])),_:1})],64)}}}),[["__scopeId","data-v-5c5eb851"]]),We=oe(g({__name:"yj-picture-size",props:{modelValue:{default:"2"}},emits:["update:modelValue"],setup(e,{emit:l}){const s=e,u=H({get:()=>s.modelValue,set:e=>{l("update:modelValue",e)}}),o=I({lists:[{name:"头像图",scaleLabel:"1:1",scaleValue:"2",style:"width: 40rpx; height: 40rpx"},{name:"媒体配图",scaleLabel:"3:4",scaleValue:"1",style:"width: 30rpx; height: 40rpx"},{name:"文章配图",scaleLabel:"4:3",scaleValue:"0",style:"width: 40rpx; height: 30rpx"},{name:"宣传海报",scaleLabel:"9:16",scaleValue:"4",style:"width: 26rpx; height: 40rpx"},{name:"电脑壁纸",scaleLabel:"16:9",scaleValue:"3",style:"width: 40rpx; height: 24rpx"},{name:"手机壁纸",scale:"1:2",style:"width: 22rpx; height: 40rpx"},{name:"横版名片",scale:"3:2",style:"width: 40rpx; height: 28rpx"},{name:"小红书图",scale:"2:3",style:"width: 26rpx; height: 40rpx"}]});return(e,l)=>{const s=v;return a(),r(s,{class:"mt-[40rpx]"},{default:n((()=>[d(s,{class:"text-base font-medium"},{default:n((()=>[i("图片尺寸")])),_:1}),d(s,{class:"flex justify-between flex-wrap"},{default:n((()=>[(a(!0),t(_,null,y(o.lists,((e,l)=>(a(),r(s,{key:l,class:x(["picture-size mt-[20rpx] rounded-[8rpx] text-center",{"picture-size-active":V(u)==e.scaleValue,"picture-size-disable":!(null==e?void 0:e.scaleValue)}]),onClick:l=>u.value=e.scaleValue},{default:n((()=>[d(s,{class:"flex justify-center items-center mt-[30rpx] h-[40rpx]"},{default:n((()=>[d(s,{class:"rect",style:p(e.style)},null,8,["style"])])),_:2},1024),d(s,{class:"text-xl mt-[8rpx] size-scale"},{default:n((()=>[i(c(e.scaleLabel),1)])),_:2},1024),d(s,{class:"text-base mt-[4px] size-name"},{default:n((()=>[i(c(e.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})}}}),[["__scopeId","data-v-ad907e34"]]),$e=oe(g({__name:"dalle3-picture-size",props:{modelValue:{default:"1024x1024"}},emits:["update:modelValue"],setup(e,{emit:l}){const s=e,u=H({get:()=>s.modelValue,set:e=>{l("update:modelValue",e)}}),o=I({lists:[{name:"头像图",scaleLabel:"1:1",scaleValue:"1024x1024",style:"width: 40rpx; height: 40rpx"},{name:"媒体配图",scaleLabel:"3:4",scaleValue:"1024x1792",style:"width: 30rpx; height: 40rpx"},{name:"文章配图",scaleLabel:"4:3",scaleValue:"1792x1024",style:"width: 40rpx; height: 30rpx"},{name:"宣传海报",scaleLabel:"9:16",style:"width: 26rpx; height: 40rpx"},{name:"电脑壁纸",scaleLabel:"16:9",style:"width: 40rpx; height: 24rpx"},{name:"手机壁纸",scale:"1:2",style:"width: 22rpx; height: 40rpx"},{name:"横版名片",scale:"3:2",style:"width: 40rpx; height: 28rpx"},{name:"小红书图",scale:"2:3",style:"width: 26rpx; height: 40rpx"}]});return l("update:modelValue","1024x1024"),(e,l)=>{const s=v;return a(),r(s,{class:"mt-[40rpx]"},{default:n((()=>[d(s,{class:"text-base font-medium"},{default:n((()=>[i("图片尺寸")])),_:1}),d(s,{class:"flex justify-between flex-wrap"},{default:n((()=>[(a(!0),t(_,null,y(o.lists,((e,l)=>(a(),r(s,{key:l,class:x(["picture-size mt-[20rpx] rounded-[8rpx] text-center",{"picture-size-active":V(u)==e.scaleValue,"picture-size-disable":!(null==e?void 0:e.scaleValue)}]),onClick:l=>u.value=e.scaleValue},{default:n((()=>[d(s,{class:"flex justify-center items-center mt-[30rpx] h-[40rpx]"},{default:n((()=>[d(s,{class:"rect",style:p(e.style)},null,8,["style"])])),_:2},1024),d(s,{class:"text-xl mt-[8rpx] size-scale"},{default:n((()=>[i(c(e.scaleLabel),1)])),_:2},1024),d(s,{class:"text-base mt-[4px] size-name"},{default:n((()=>[i(c(e.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})}}}),[["__scopeId","data-v-24c1d6ac"]]),Xe=oe(g({__name:"dalle3-style-picker",props:{modelValue:{default:"vivid"}},emits:["update:modelValue"],setup(e,{emit:l}){const u=e,o=H({get:()=>u.modelValue,set:e=>{l("update:modelValue",e)}}),r=[{value:"vivid",label:"生动"},{value:"natural",label:"自然"}];return l("update:modelValue","vivid"),(e,l)=>(a(),t(_,null,[s("h3",{class:"text-base font-bold mt-[40rpx]"},[s("span",null,"风格选择")]),s("div",{class:"mt-[20rpx]"},[(a(),t(_,null,y(r,(e=>s("div",{key:e.value,class:x(["style-option",{"style-option__active":e.value===V(o)}]),onClick:l=>o.value=e.value},c(e.label),11,["onClick"]))),64))])],64))}}),[["__scopeId","data-v-510fe4ff"]]),el=oe(g({__name:"dalle3-size-type",props:{modelValue:{default:"standard"}},emits:["update:modelValue"],setup(e,{emit:l}){const u=e,o=H({get:()=>u.modelValue,set:e=>{l("update:modelValue",e)}}),r=[{value:"standard",label:"标准"},{value:"hd",label:"HD-高清"}];return(e,l)=>(a(),t(_,null,[s("h3",{class:"text-base font-bold mt-[40rpx]"},[s("span",null,"图片质量")]),s("div",{class:"mt-[20rpx]"},[(a(),t(_,null,y(r,(e=>s("div",{key:e.value,class:x(["size-type-option",{"size-type-option__active":e.value===V(o)}]),onClick:l=>o.value=e.value},c(e.label),11,["onClick"]))),64))])],64))}}),[["__scopeId","data-v-7eee4e93"]]),ll=oe(g({__name:"sd-model-picker",props:{modelList:null,modelValue:{default:""}},emits:["update:modelValue"],setup(e,{emit:l}){const u=e,o=H({get:()=>u.modelValue,set:e=>{l("update:modelValue",e)}});return O((()=>{const e=u.modelList;0!==e.length&&(o.value=e[0].model_name)})),(l,u)=>(a(),t(_,null,[s("h3",{class:"text-base font-bold mt-[40rpx]"},[s("span",null,"模型选择")]),s("div",{class:"mt-[20rpx]"},[(a(!0),t(_,null,y(e.modelList,(e=>(a(),t("div",{key:e.value,class:x(["style-option",{"style-option__active":e.model_name==V(o)}]),onClick:l=>o.value=e.model_name},c(e.model_name),11,["onClick"])))),128))])],64))}}),[["__scopeId","data-v-b94cc206"]]),al=oe(g({__name:"sd-picture-size",props:{modelValue:{default:"1024x1024"}},emits:["update:modelValue"],setup(e,{emit:l}){const s=e,u=H({get:()=>s.modelValue,set:e=>{l("update:modelValue",e)}}),o=I({lists:[{name:"头像图",scaleLabel:"1:1",scaleValue:"1024x1024",style:"width: 40rpx; height: 40rpx"},{name:"媒体配图",scaleLabel:"3:4",scaleValue:"1024x1365",style:"width: 30rpx; height: 40rpx"},{name:"文章配图",scaleLabel:"4:3",scaleValue:"1365x1024",style:"width: 40rpx; height: 30rpx"},{name:"宣传海报",scaleLabel:"9:16",scaleValue:"720x1280",style:"width: 26rpx; height: 40rpx"},{name:"电脑壁纸",scaleLabel:"16:9",scaleValue:"1920x1080",style:"width: 40rpx; height: 24rpx"},{name:"手机壁纸",scaleLabel:"1:2",scaleValue:"720x1440",style:"width: 22rpx; height: 40rpx"},{name:"横版名片",scaleLabel:"3:2",scaleValue:"960x640",style:"width: 40rpx; height: 28rpx"},{name:"小红书图",scaleLabel:"2:3",scaleValue:"800x1200",style:"width: 26rpx; height: 40rpx"}]});return(e,l)=>{const s=v;return a(),r(s,{class:"mt-[40rpx]"},{default:n((()=>[d(s,{class:"text-base font-medium"},{default:n((()=>[i("图片尺寸")])),_:1}),d(s,{class:"flex justify-between flex-wrap"},{default:n((()=>[(a(!0),t(_,null,y(o.lists,((e,l)=>(a(),r(s,{key:l,class:x(["picture-size mt-[20rpx] rounded-[8rpx] text-center",{"picture-size-active":V(u)==e.scaleValue,"picture-size-disable":!(null==e?void 0:e.scaleValue)}]),onClick:l=>u.value=e.scaleValue},{default:n((()=>[d(s,{class:"flex justify-center items-center mt-[30rpx] h-[40rpx]"},{default:n((()=>[d(s,{class:"rect",style:p(e.style)},null,8,["style"])])),_:2},1024),d(s,{class:"text-xl mt-[8rpx] size-scale"},{default:n((()=>[i(c(e.scaleLabel),1)])),_:2},1024),d(s,{class:"text-base mt-[4px] size-name"},{default:n((()=>[i(c(e.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})}}}),[["__scopeId","data-v-3862397d"]]),tl=()=>{const e=k({detail:{}}),a=k([]);return{getYjSdData:async()=>{try{e.value=await l.get({url:"/draw/getSelector"}),console.log(e.value)}catch(a){console.log("获取意间数据出现错误==>",a)}},yjData:e,getSdData:async()=>{try{a.value=await l.get({url:"/draw/getSdModel"})}catch(e){console.log("获取Sd数据出现错误==>",e)}},sdData:a}},sl=g({__name:"index",setup(e){const l=L(),g=w(),y=b("pageIndex"),h=b("consumptionCount"),C=b("drawForm"),A=b("isReceiving"),j=b("drawingHandler"),z=L(),I=L(),F=k(!1),R=async()=>{F.value=!0,await S(),F.value=!1,await I.value.getDrawingExample()},U=()=>{uni.$u.debounce(R,500)},{yjData:T,getYjSdData:Z,sdData:E,getSdData:M}=tl();D((()=>null==C?void 0:C.model),(e=>{"sd"===e?(C.scale="1024x1024",M()):"yijian_sd"===e?(C.scale="2",C.style="default",Z()):"dalle3"===e?(C.scale="1024x1024",C.style="vivid"):(C.scale="1:1",C.style="default")}),{deep:!1,immediate:!1});const N=()=>{C.action="generate",j({drawing:C,isClear:!0})};return(e,b)=>{const w=v,k=q,j=u(o("u-icon"),re),L=P,D=u(o("u-button"),te);return a(),r(w,{class:"h-full flex flex-col"},{default:n((()=>[d(w,{class:"flex-1 min-h-0"},{default:n((()=>[f("    生成选择    "),d(Oe,{ref_key:"generationPickerRef",ref:z,modelValue:V(C).model,"onUpdate:modelValue":b[0]||(b[0]=e=>V(C).model=e),balance:V(h),"onUpdate:balance":b[1]||(b[1]=e=>G(h)?h.value=e:null)},null,8,["modelValue","balance"]),d(k,{class:"h-full",style:{"border-top":"1px #f2f2f2 solid"},"scroll-y":!0,"refresher-enabled":!0,"scroll-anchoring":!0,"refresher-triggered":F.value,onRefresherpulling:U},{default:n((()=>[d(w,{class:"h-full p-[30rpx] relative"},{default:n((()=>[d(w,{class:"pb-[100px]"},{default:n((()=>[f("    描述词    "),d(qe,{modelValue:V(C).prompt,"onUpdate:modelValue":b[2]||(b[2]=e=>V(C).prompt=e),keydownRef:V(l)},null,8,["modelValue","keydownRef"]),f("    关键词示例    "),d(Be,{ref_key:"examplePromptRef",ref:I,modelValue:V(C).prompt,"onUpdate:modelValue":b[3]||(b[3]=e=>V(C).prompt=e)},null,8,["modelValue"]),f("    上传参考图    "),"dalle3"!==V(C).model?(a(),r(He,{key:0,modelValue:V(C).image_base,"onUpdate:modelValue":b[4]||(b[4]=e=>V(C).image_base=e)},null,8,["modelValue"])):f("v-if",!0),f("    本地SD组件    "),"sd"===V(C).model?(a(),t(_,{key:1},[f("    图片尺寸    "),d(al,{modelValue:V(C).scale,"onUpdate:modelValue":b[5]||(b[5]=e=>V(C).scale=e)},null,8,["modelValue"]),f("    模型选择    "),d(ll,{modelValue:V(C).engine,"onUpdate:modelValue":b[6]||(b[6]=e=>V(C).engine=e),"model-list":V(E)},null,8,["modelValue","model-list"])],64)):"yijian_sd"===V(C).model?(a(),t(_,{key:2},[f("    意间SD组件    "),f("    图片尺寸    "),d(We,{modelValue:V(C).scale,"onUpdate:modelValue":b[7]||(b[7]=e=>V(C).scale=e)},null,8,["modelValue"]),f("    模型选择    "),d(Je,{modelValue:V(C),"onUpdate:modelValue":b[8]||(b[8]=e=>G(C)?C.value=e:null),data:V(T).detail},null,8,["modelValue","data"])],64)):"dalle3"===V(C).model?(a(),t(_,{key:3},[f("    DALLE3 组件    "),f("    图片尺寸    "),d($e,{modelValue:V(C).scale,"onUpdate:modelValue":b[9]||(b[9]=e=>V(C).scale=e)},null,8,["modelValue"]),f("    风格选择    "),d(Xe,{modelValue:V(C).style,"onUpdate:modelValue":b[10]||(b[10]=e=>V(C).style=e)},null,8,["modelValue"]),f("    图片质量    "),d(el,{modelValue:V(C).quality,"onUpdate:modelValue":b[11]||(b[11]=e=>V(C).quality=e)},null,8,["modelValue"])],64)):(a(),t(_,{key:4},[f("    MJ 组件    "),f("    模型选择    "),d(Qe,{version:V(C).version,"onUpdate:version":b[12]||(b[12]=e=>V(C).version=e),style:p(V(C).style),"onUpdate:style":b[13]||(b[13]=e=>V(C).style=e)},null,8,["version","style"]),f("    图片尺寸    "),d(Ke,{modelValue:V(C).scale,"onUpdate:modelValue":b[14]||(b[14]=e=>V(C).scale=e)},null,8,["modelValue"]),f("    忽略的元素    "),d(Ge,{modelValue:V(C).no_content,"onUpdate:modelValue":b[15]||(b[15]=e=>V(C).no_content=e)},null,8,["modelValue"]),f("    其它参数    "),d(Pe,{modelValue:V(C).other,"onUpdate:modelValue":b[16]||(b[16]=e=>V(C).other=e)},null,8,["modelValue"])],64))])),_:1})])),_:1})])),_:1},8,["refresher-triggered"])])),_:1}),d(w,{class:"bg-white z-10 w-full p-[20rpx]",style:{"box-shadow":"0 0 10rpx rgba(0, 0, 0, 0.2)"}},{default:n((()=>[d(w,{class:"flex justify-between items-center pb-[20rpx]"},{default:n((()=>{var e,l,u,o,m,p;return[d(w,{class:x(["text-center text-[#999999]",{"m-auto":!(null==(l=null==(e=V(g))?void 0:e.getDrawConfig)?void 0:l.disclaimer_status)}])},{default:n((()=>[V(h)?(a(),t(_,{key:0},[i(" 消耗 "),s("span",{class:"text-primary"},c(V(h)||0),1),i(" 条绘画条数 ")],64)):(a(),t(_,{key:1},[i(" 会员免费 ")],64))])),_:1},8,["class"]),(null==(o=null==(u=V(g))?void 0:u.getDrawConfig)?void 0:o.disclaimer_status)?(a(),r(Ye,{key:0,content:null==(p=null==(m=V(g))?void 0:m.getDrawConfig)?void 0:p.disclaimer_content},{default:n((()=>[d(w,{class:"flex items-center text-[#999999]"},{default:n((()=>[d(j,{name:"question-circle"}),d(L,{class:"ml-[4rpx]"},{default:n((()=>[i("免责声明")])),_:1})])),_:1})])),_:1},8,["content"])):f("v-if",!0)]})),_:1}),f("    生成    "),d(w,{class:"flex w-full h-[82rpx] bg-[#f0f2f2] rounded-[999px] text-[#333333]"},{default:n((()=>[d(w,{class:"w-[50%] h-[82rpx] flex justify-center items-center",onClick:b[17]||(b[17]=e=>y.value=1)},{default:n((()=>[i(" 生成记录 ")])),_:1}),d(w,{class:"w-[50%]"},{default:n((()=>[d(D,{type:"primary","custom-style":{width:"100%",height:"82rpx",fontSize:"30rpx",margin:"0"},shape:"circle",loading:V(A),onClick:m(N,["stop"])},{default:n((()=>[i(" 立即生成 ")])),_:1},8,["loading","onClick"])])),_:1})])),_:1})])),_:1}),d(Ne,{ref_key:"keywordSuggestionRef",ref:l,modelValue:V(C).prompt,"onUpdate:modelValue":b[18]||(b[18]=e=>V(C).prompt=e)},null,8,["modelValue"])])),_:1})}}}),ul=()=>{const e=F(),a=k(0),t=k(0),s=I({prompt:"",action:"generate",image_base:"",other:"",image_id:"",model:"",scale:"1:1",no_content:"",version:"",style:"default",engine:"",quality:"standard"}),u=k(!1),o=k([]),r=k(3),n=[{name:"全部",value:-1},{name:"绘画完成",value:3},{name:"进行中",value:1},{name:"绘画失败",value:2}],i=L(null),c=k([]),d=async e=>{try{(await U({title:"温馨提示",content:"是否确认删除当前绘画?",confirmColor:"#FFC94D"})).confirm&&(await(a={ids:e},l.post({url:"/draw_records/delete",data:a,method:"POST"})),v(),m())}catch(t){console.log("删除失败绘画记录",t)}var a},m=async()=>{var e;null==(e=null==i?void 0:i.value)||e.reload()},p=async e=>{v(),i.value=e.reload,c.value=e.lists,o.value=e.lists.filter((e=>(1===e.status||0==e.status)&&e.loading)).map((e=>e.id)),console.log(!!o.value.length),setTimeout((()=>{o.value.length&&x()}),100)},f=()=>{const a=async()=>{await m(),await e.getUser()},{start:t,end:s,result:u}=_e((async()=>{try{const e=await function(e){return l.post({url:"/draw_records/detail",data:e})}({records_id:o.value});return e.filter((e=>3==e.status||2==e.status||!e.loading)).length&&(s(),a()),e}catch(e){s(),a(),console.log("获取详情失败=>",e)}}),{totalTime:48e4,time:5e3,count:96,callback:a});return{start:t,end:s,result:u}},{start:x,end:v}=f();T((()=>{v()})),E((()=>{a.value=0,v()}));const g=async t=>{if(!e.isLogin)return K({url:"/pages/login/login"});if(!t.drawing.prompt)return uni.$u.toast("请输入绘画描述！");C({title:"请求中"});try{v(),await(o=t.drawing,l.post({url:"/draw/imagine",data:o,method:"POST",timeout:12e4})),r.value=-1,a.value=1,u.value=!0,c.value.unshift({status:1}),null==i||i.value.complete(c.value),t.isClear&&(s.prompt="",s.image_base="",s.no_content="",s.other=""),await m()}catch(n){if(c.value.splice(0,1),null==i||i.value.complete(c.value),"余额不足"===n){return void((await U({title:"绘画余额不足",content:"绘画余额不足，请前往充值",confirmText:"前往充值"})).confirm&&(e.isLogin?K({url:"/packages/pages/recharge/recharge"}):K({url:"/pages/login/login"})))}console.log("绘制失败=>",n),await m()}finally{A(),u.value=!1}var o};return $("drawForm",s),$("pageIndex",a),$("consumptionCount",t),$("isReceiving",u),$("taskIndex",r),$("taskLists",n),$("deleteDrawing",d),$("setTaskRecordFunc",p),$("drawingHandler",g),{pageIndex:a,isReceiving:u,taskIndex:r,taskLists:n,deleteDrawing:d,setTaskRecordFunc:p,useDetails:f,drawingHandler:g}},ol=oe(g({__name:"drawing",setup(l){const{pageIndex:s}=ul(),i=ee(),c=w(),m=H((()=>{var e,l,a;return(null==(a=null==(l=null==(e=c.getTabbarConfig)?void 0:e.list)?void 0:l.filter((e=>"1"==e.is_show)))?void 0:a.map((e=>({pagePath:e.link.path}))))||[]})),p=H((()=>(()=>{const e=m.value.findIndex((e=>e.pagePath===i.path));return"/"==i.path?0:e})()>=0));return X((({type:e})=>{setTimeout((()=>{1==e&&(s.value=1)}),500)})),(l,i)=>{const m=u(o("page-meta"),e),g=u(o("u-empty"),le),y=u(o("tabbar"),ae),h=v;return a(),t(_,null,[d(m,{"page-style":l.$theme.pageStyle},null,8,["page-style"]),V(c).getDrawConfig.is_open?(a(),r(h,{key:1,class:"drawing-container"},{default:n((()=>[d(h,{class:x(["drawing-content",{"safe-area-inset-bottom":!V(p)}])},{default:n((()=>[M(d(h,{class:"h-full"},{default:n((()=>[d(sl,{class:"h-full"})])),_:1},512),[[N,0==V(s)]]),M(d(h,{class:"h-full"},{default:n((()=>[d(Me,{class:"h-full"})])),_:1},512),[[N,1==V(s)]])])),_:1},8,["class"]),d(y),f("    悬浮菜单    "),d(De)])),_:1})):(a(),r(h,{key:0,class:"w-full h-full bg-white rounded-[6px] flex items-center justify-center"},{default:n((()=>[d(g,{text:"绘画功能未开启",mode:"favor"}),d(y)])),_:1}))],64)}}}),[["__scopeId","data-v-7ab56dc6"]]);export{ol as default};
