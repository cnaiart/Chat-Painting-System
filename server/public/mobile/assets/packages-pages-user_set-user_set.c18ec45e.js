import{d as e,x as a,r as l,aP as t,z as s,aQ as u,C as o,K as r,a8 as n,a9 as i,a1 as c,s as d,aR as p,a3 as m,o as v,i as f,g as _,f as x,j as b,h,t as g,u as w,e as y,F as k,aS as j,$ as V,a0 as C,a2 as I,a7 as U,aT as N,az as $,aU as A,aV as B,aW as E,aX as z,a as D,b as T,k as X,a4 as M,a5 as R,a6 as W}from"./index-c4e9cb21.js";import{_ as L}from"./page-meta.0a6ed5a4.js";import{_ as O}from"./avatar-upload.852b8dec.js";import{_ as S}from"./u-icon.9d0b6bc8.js";import{_ as F}from"./u-button.d1dcbae7.js";import{_ as G}from"./u-form-item.ae11617d.js";import{_ as H}from"./u-popup.550d714f.js";import{_ as K}from"./u-input.c26a5a94.js";import{_ as P}from"./u-verification-code.3244e1ea.js";import{_ as Q}from"./u-action-sheet.4b0c3030.js";import{u as q}from"./useCopy.c5769034.js";import{F as J}from"./floating-menu.33dda305.js";import{_ as Y}from"./_plugin-vue_export-helper.1b428a4d.js";import"./_commonjsHelpers.02d3be64.js";import"./emitter.1571a5d9.js";const Z=Y(e({__name:"user_set",setup(e){const{copy:Y}=q(),Z=a(),ee=l({}),ae=l(t.NONE),le=l(!1),te=l(!1),se=l(!1),ue=l(!1),oe=l([{text:"修改密码"},{text:"忘记密码"}]),re=l(""),ne=l(""),ie=l(""),ce=l(""),de=l(""),pe=s(),me=async()=>{ee.value=await j()},ve=e=>{de.value=e},fe=async()=>{var e,a;if(!ie.value)return uni.$u.toast("请输入新的手机号码");(null==(e=pe.value)?void 0:e.canGetCode)&&(await V({scene:ee.value.mobile?C.CHANGE_MOBILE:C.BIND_MOBILE,mobile:ie.value}),uni.$u.toast("发送成功"),null==(a=pe.value)||a.start())},_e=async e=>{c({title:"正在上传中..."});try{const a=await I(e);xe(a.uri),m()}catch(a){m(),uni.$u.toast(a)}},xe=e=>{ae.value=t.AVATAR,he(e)},be=async()=>{await U({type:ee.value.mobile?"change":"bind",mobile:ie.value,code:ce.value}),uni.$u.toast("操作成功"),se.value=!1,me()},he=async e=>{await N({field:ae.value,value:e}),uni.$u.toast("操作成功"),me()},ge=()=>""==ne.value?uni.$u.toast("账号不能为空"):ne.value.length>10?uni.$u.toast("账号长度不得超过十位数"):(ae.value=t.USERNAME,he(ne.value),void(te.value=!1)),we=async e=>(re.value=e.detail.value.nickname,""==re.value?uni.$u.toast("昵称不能为空"):re.value.length>10?uni.$u.toast("昵称长度不得超过十位数"):(ae.value=t.NICKNAME,await he(re.value),void(le.value=!1))),ye=()=>{$.navigateTo("/packages/pages/cancelaccount/cancelaccount")},ke=()=>{if(!ee.value.has_password)return $.navigateTo("/packages/pages/change_password/change_password?type=set");ue.value=!0},je=e=>{switch(e){case 0:$.navigateTo("/packages/pages/change_password/change_password");break;case 1:$.navigateTo("/packages/pages/forget_pwd/forget_pwd?type="+(ee.value.mobile?2:3))}},Ve=()=>{Z.logout(),$.reLaunch("/pages/index/index")},Ce=l(!0);Ce.value=u();const Ie=async()=>{if(!(null==ee?void 0:ee.value.has_auth)){c({title:"请稍后..."});try{if(A()==B.MP_WEIXIN){const{code:e}=await E({provider:"weixin"});await z({code:e})}else A()==B.OA_WEIXIN&&n.getUrl(i.BIND_WX)}catch(e){uni.$u.toast(e)}finally{m()}}};return o((async()=>{me()})),r((async e=>{const{code:a,scene:l}=n.getAuthData();if(a.length&&l===i.BIND_WX){c({title:"请稍后..."}),d.set("code",a);try{await p({code:a})}catch(t){}finally{m(),n.setAuthData()}}})),(e,a)=>{const l=D(T("page-meta"),L),t=D(T("avatar-upload"),O),s=X,u=D(T("u-icon"),S),o=D(T("u-button"),F),r=M,n=D(T("u-form-item"),G),i=R,c=W,d=D(T("u-popup"),H),p=D(T("u-input"),K),m=D(T("u-verification-code"),P),j=D(T("u-action-sheet"),Q);return v(),f(k,null,[_(l,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),_(s,{class:"user-set p-[20rpx]"},{default:x((()=>{var e;return[_(s,{class:"bg-white rounded-[14rpx]"},{default:x((()=>[_(s,{class:"header pt-[30rpx]"},{default:x((()=>[_(s,{class:"flex justify-center pb-5"},{default:x((()=>[_(t,{modelValue:ee.value.avatar,"onUpdate:modelValue":a[0]||(a[0]=e=>ee.value.avatar=e),"file-key":"url",round:!0,onUpload:_e},{footer:x((()=>[])),_:1},8,["modelValue"])])),_:1})])),_:1}),_(s,{class:"px-[20rpx]"},{default:x((()=>[b(" 用户ID "),b("                <view"),b('                    class="item text-nr flex justify-between"'),b('                    @click="'),b("                        ;(showUserName = true),"),b("                            (newUsername = userInfo?.username)"),b('                    "'),b("                >"),b('                    <view class="label">账号</view>'),b('                    <view class="content">{{ userInfo?.account }}</view>'),b('                    <u-icon name="arrow-right" size="22" color="#666"></u-icon>'),b("                </view>"),b(" 昵称 "),_(s,{class:"item text-nr flex justify-between",onClick:a[1]||(a[1]=e=>{var a;le.value=!0,re.value=null==(a=ee.value)?void 0:a.nickname})},{default:x((()=>[_(s,{class:"label"},{default:x((()=>[h("昵称")])),_:1}),_(s,{class:"content"},{default:x((()=>{var e;return[h(g(null==(e=ee.value)?void 0:e.nickname),1)]})),_:1}),_(u,{name:"arrow-right",size:"22",color:"#666"})])),_:1}),_(s,{class:"item text-nr flex justify-between",onClick:a[2]||(a[2]=e=>{var a;return w(Y)(null==(a=ee.value)?void 0:a.sn)})},{default:x((()=>[_(s,{class:"label"},{default:x((()=>[h("用户ID")])),_:1}),_(s,{class:"content"},{default:x((()=>{var e;return[h(g(null==(e=ee.value)?void 0:e.sn),1)]})),_:1}),_(u,{name:"arrow-right",size:"22",color:"#666"})])),_:1}),b(" 手机号 "),_(s,{class:"item text-nr flex justify-between"},{default:x((()=>[_(s,{class:"label"},{default:x((()=>[h("手机号")])),_:1}),_(s,{class:"content"},{default:x((()=>{var e,a;return[h(g(""==(null==(e=ee.value)?void 0:e.mobile)?"未绑定手机号":null==(a=ee.value)?void 0:a.mobile),1)]})),_:1}),_(o,{onClick:a[3]||(a[3]=e=>se.value=!0),size:"mini",type:"primary",shape:"circle",plain:!0},{default:x((()=>{var e;return[h(g(""==(null==(e=ee.value)?void 0:e.mobile)?"绑定手机号":"更换手机号"),1)]})),_:1})])),_:1}),b(" 注册时间 "),_(s,{class:"item text-nr flex justify-between"},{default:x((()=>[_(s,{class:"label"},{default:x((()=>[h("注册时间")])),_:1}),_(s,{class:"content"},{default:x((()=>{var e;return[h(g(null==(e=ee.value)?void 0:e.create_time),1)]})),_:1})])),_:1}),b(" 微信绑定 "),Ce.value?(v(),y(s,{key:0,class:"item text-nr flex justify-between",onClick:Ie},{default:x((()=>{var e;return[_(s,{class:"label"},{default:x((()=>[h("微信绑定")])),_:1}),_(s,{class:"content"},{default:x((()=>{var e;return[h(g(0==(null==(e=ee.value)?void 0:e.has_auth)?"未绑定":"已绑定"),1)]})),_:1}),0==(null==(e=ee.value)?void 0:e.has_auth)?(v(),y(u,{key:0,name:"arrow-right",size:"22",color:"#666"})):b("v-if",!0)]})),_:1})):b("v-if",!0)])),_:1})])),_:1}),b(" 登录密码 "),_(s,{class:"text-nr flex justify-between mt-[10rpx] px-[30rpx] bg-white h-[100rpx] items-center",onClick:ke},{default:x((()=>[_(s,{class:""},{default:x((()=>[h("登录密码")])),_:1}),_(u,{name:"arrow-right",color:"#666"})])),_:1}),b(" 注销账号 "),(null==(e=ee.value)?void 0:e.is_cancelled)?(v(),y(s,{key:0,class:"text-nr flex justify-between mt-[10rpx] px-[30rpx] bg-white h-[100rpx] items-center",onClick:ye},{default:x((()=>[_(s,{class:"label"},{default:x((()=>[h("注销账号")])),_:1}),_(u,{name:"arrow-right",size:"22",color:"#666"})])),_:1})):b("v-if",!0),b(" 退出登录 "),_(s,{class:"item text-nr flex justify-center items-center mt-[10rpx] px-[30rpx] bg-white h-[100rpx]",onClick:Ve},{default:x((()=>[h(" 退出登录 ")])),_:1}),b(" 昵称修改组件 "),_(d,{modelValue:le.value,"onUpdate:modelValue":a[4]||(a[4]=e=>le.value=e),closeable:!0,mode:"center",maskCloseAble:!1,"border-radius":"20"},{default:x((()=>[_(s,{class:"px-[50rpx] py-[40rpx] bg-white",style:{width:"85vw"}},{default:x((()=>[_(c,{onSubmit:we},{default:x((()=>[_(s,{class:"mb-[70rpx] text-xl text-center"},{default:x((()=>[h(" 修改昵称 ")])),_:1}),_(n,{borderBottom:""},{default:x((()=>[_(r,{class:"nr h-[60rpx] w-full",value:ee.value.nickname,name:"nickname",type:"nickname",placeholder:"请输入昵称"},null,8,["value"])])),_:1}),_(s,{class:"mt-[80rpx]"},{default:x((()=>[_(i,{"form-type":"submit",class:"bg-primary rounded-full h-[80rpx] text-lg leading-[80rpx] text-btn-text"},{default:x((()=>[h(" 确定 ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),b(" 账号修改组件 "),_(d,{modelValue:te.value,"onUpdate:modelValue":a[6]||(a[6]=e=>te.value=e),closeable:!0,mode:"center","border-radius":"20"},{default:x((()=>[_(s,{class:"px-[50rpx] py-[40rpx] bg-white",style:{width:"85vw"}},{default:x((()=>[_(s,{class:"mb-[70rpx] text-xl text-center"},{default:x((()=>[h("修改账号")])),_:1}),_(n,{borderBottom:""},{default:x((()=>[_(p,{class:"flex-1",modelValue:ne.value,"onUpdate:modelValue":a[5]||(a[5]=e=>ne.value=e),placeholder:"请输入账号",border:!1},null,8,["modelValue"])])),_:1}),_(s,{class:"mt-[80rpx]"},{default:x((()=>[_(o,{onClick:ge,type:"primary",shape:"circle"},{default:x((()=>[h(" 确定 ")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),b(" 账号修改组件 "),_(d,{modelValue:se.value,"onUpdate:modelValue":a[9]||(a[9]=e=>se.value=e),closeable:!0,mode:"center","border-radius":"20"},{default:x((()=>[_(s,{class:"px-[50rpx] py-[40rpx] bg-white",style:{width:"85vw"}},{default:x((()=>[_(s,{class:"mb-[70rpx] text-xl text-center"},{default:x((()=>[h(" 修改手机号码 ")])),_:1}),_(n,{borderBottom:""},{default:x((()=>[_(p,{class:"flex-1",modelValue:ie.value,"onUpdate:modelValue":a[7]||(a[7]=e=>ie.value=e),placeholder:"请输入新的手机号码",border:!1},null,8,["modelValue"])])),_:1}),_(n,{borderBottom:""},{default:x((()=>[_(p,{class:"flex-1",modelValue:ce.value,"onUpdate:modelValue":a[8]||(a[8]=e=>ce.value=e),placeholder:"请输入验证码",border:!1},null,8,["modelValue"]),_(s,{class:"border-l border-solid border-0 border-light pl-3 text-muted leading-4 ml-3 w-[180rpx]",onClick:fe},{default:x((()=>[_(m,{ref_key:"uCodeRef",ref:pe,seconds:60,onChange:ve,"change-text":"x秒"},null,512),h(" "+g(de.value),1)])),_:1})])),_:1}),_(s,{class:"mt-[80rpx]"},{default:x((()=>[_(o,{onClick:be,type:"primary",shape:"circle"},{default:x((()=>[h(" 确定 ")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),b("    选择密码    "),_(j,{list:oe.value,modelValue:ue.value,"onUpdate:modelValue":a[10]||(a[10]=e=>ue.value=e),onClick:je,"safe-area-inset-bottom":!0},null,8,["list","modelValue"]),b("    悬浮菜单    "),_(J)]})),_:1})],64)}}}),[["__scopeId","data-v-af5c7aec"]]);export{Z as default};
