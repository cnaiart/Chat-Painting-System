"use strict";const e=require("../../common/vendor.js"),n=require("../../stores/app.js"),o=require("../../api/app.js"),t=require("../../api/shop.js"),i=require("../../stores/user.js");if(require("../../utils/request/index.js"),require("../../utils/request/http.js"),require("../../enums/requestEnums.js"),require("../../utils/request/cancel.js"),require("../../router/index.js"),require("../../utils/cache.js"),require("../../enums/constantEnums.js"),require("../../config/index.js"),require("../../utils/client.js"),require("../../enums/appEnums.js"),require("../../api/user.js"),require("../../mixins/share.js"),require("../../api/task.js"),require("../../utils/util.js"),require("../../stores/navigationBarTitle.js"),require("../../utils/auth.js"),!Array){(e.resolveComponent("l-painter-image")+e.resolveComponent("l-painter-view")+e.resolveComponent("l-painter-text")+e.resolveComponent("l-painter")+e.resolveComponent("u-button")+e.resolveComponent("u-popup"))()}Math||((()=>"../../uni_modules/lime-painter/components/l-painter-image/l-painter-image.js")+(()=>"../../uni_modules/lime-painter/components/l-painter-view/l-painter-view.js")+(()=>"../../uni_modules/lime-painter/components/l-painter-text/l-painter-text.js")+(()=>"../../uni_modules/lime-painter/components/l-painter/l-painter.js")+(()=>"../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js"))();const r=e.defineComponent({__name:"dialog-poster",setup(r,{expose:s}){const{getImageUrl:l,config:p}=n.useAppStore(),a=i.useUserStore(),{userInfo:u}=e.storeToRefs(a),d=e.ref(),c=e.reactive({showPoster:!1,title:"",content:"",mp_qr_code:"",invite_link:"",options:{data:"邀请您前来体验",default:1,poster:1,defaultUrl1:"",defaultUrl2:"",posterUrl:"",showData:"1"},poster_url:""}),x=e.ref(""),m=e.computed((()=>{const e=null==c?void 0:c.options;return e?(console.log(e.bgColor),e.bgColor):""})),g=()=>{e.index.saveImageToPhotosAlbum({filePath:c.poster_url,success:()=>{e.index.$u.toast("保存成功")},fail:n=>{e.index.$u.toast("保存失败"),console.log(n)}})},v=async()=>{var n;try{null==(n=d.value)||n.canvasToTempFilePathSync({fileType:"png",pathType:"url",quality:1,success:n=>{console.log("生产结果",n),e.index.hideLoading(),c.showPoster=!0,c.poster_url=n.tempFilePath},fail:n=>{console.log(n),e.index.hideLoading(),e.index.$u.toast("调用海报错误",n)}})}catch(o){e.index.hideLoading(),e.index.$u.toast("调用海报错误",o)}};return s({handleDrawCanvas:v,initPosterData:async n=>{var i,r;await e.index.showLoading({title:"生成中"});try{(null==(i=null==u?void 0:u.value)?void 0:i.sn)||await a.getUser();const{data:s}=await t.getDecorate({id:6});if(!c.mp_qr_code){const{result:e}=await o.getMnpQrCode({user_sn:u.value.sn,page:"pages/index/index"});c.mp_qr_code=e}c.title=n.title.replace(/\n/g,""),c.content=n.content,c.options=null==(r=JSON.parse(s)[0])?void 0:r.content,(()=>{const e=null==c?void 0:c.options;1==e.default&&1==e.poster?x.value=l(e.defaultUrl1):1==e.default&&2==e.poster?x.value=l(null==c?void 0:c.options.defaultUrl2):2==e.default&&(x.value=l(e.posterUrl))})(),await e.nextTick$1(),await v()}catch(s){e.index.$u.toast(s),e.index.hideLoading(),console.log("请求生产海报失败",s)}}}),(n,o)=>{var t,i,r,s,l,p,a,v,h,b;return e.e({a:e.p({src:x.value,css:"width: 100%;"}),b:e.p({css:"\n                display: block;\n                left: 0;\n                top: 0;\n                position: absolute;\n                width: 100%;\n                z-index: -1;\n                "}),c:e.p({text:null==c?void 0:c.title,css:"\n                        box-sizing: border-box;\n                        display: block;\n                        color: #101010;\n                        font-size: 34rpx;\n                        font-weight: 500;\n                        padding-bottom: 20rpx;\n                        line-clamp: 2;\n                    "}),d:e.p({text:null==c?void 0:c.content,css:`\n                        box-sizing: border-box;\n                        display: block;\n                        line-height: 40rpx;\n                        color: #333333;\n                        font-size: 28rpx;\n                        padding-bottom: 20rpx;\n                        ${1==(null==(t=null==c?void 0:c.options)?void 0:t.showContentType)?`line-clamp: ${null==(i=null==c?void 0:c.options)?void 0:i.contentNum}`:""}\n                    `}),e:e.p({css:"\n                    box-sizing: border-box;\n                    padding: 20rpx;\n                    border-radius: 14rpx;\n                    background: #fff;\n                    margin-top: 240rpx;\n                "}),f:e.p({src:null==(r=e.unref(u))?void 0:r.avatar,css:"width: 110rpx; height: 110rpx; border-radius: 50%;display: inline-block;"}),g:e.p({text:null==(s=e.unref(u))?void 0:s.nickname,css:`color: ${null==(l=null==c?void 0:c.options)?void 0:l.textColor}; font-size: 26rpx;line-clamp:1;width: 200rpx;`}),h:null==(p=null==c?void 0:c.options)?void 0:p.showData},(null==(a=null==c?void 0:c.options)?void 0:a.showData)?{i:e.p({text:null==(v=null==c?void 0:c.options)?void 0:v.data,css:`color: ${null==(h=null==c?void 0:c.options)?void 0:h.textColor}; font-size: 26rpx;line-clamp:1;width: 200rpx;`})}:{},{j:e.p({css:"\n                            width: 270rpx;\n                            height: 110rpx;\n                            vertical-align: middle;\n                            margin-top: 18rpx;\n                            padding-left: 20rpx;\n                            display: inline-block;\n                            box-sizing: border-box;\n                       "}),k:e.p({css:"display: inline-block; width: 380rpx; margin-top: 40rpx;"}),l:e.p({src:c.mp_qr_code,css:"\n                            box-sizing: border-box;\n                            width: 170rpx;\n                            height: 170rpx;\n                            border-radius: 8rpx;\n                            background-color: #FFFFFF;\n                        "}),m:e.p({text:"长按识别二维码",css:`\n                            display: block;\n                            color: ${null==(b=null==c?void 0:c.options)?void 0:b.textColor}; \n                            font-size: 24rpx;\n                            text-align: center;\n                            margin-top: 4rpx;\n                        `}),n:e.p({css:"display: inline-block;width: 180rpx; text-align: center;"}),o:e.p({css:"\n                    display: block;\n                    margin-top: 30rpx;\n                    padding-bottom: 40rpx;\n                "}),p:e.p({css:"\n                display: block;\n                box-sizing: border-box;\n                border-radius: 14rpx;\n                width: 100%;\n                height: 100%;\n                padding: 0 40rpx;\n            "}),q:e.p({css:`\n            border-radius: 14rpx;\n            overflow: hidden;\n            background-color: ${e.unref(m)};\n            `}),r:e.sr(d,"1b57ef8c-0",{k:"painterRef"}),s:e.p({isCanvasToTempFilePath:!1,css:"width: 640rpx;","custom-style":"position: fixed; left: 200%;"}),t:c.poster_url,v:e.o(g),w:e.p({type:"primary",shape:"circle",size:"default",customStyle:{padding:"0 30rpx",height:"82rpx"}}),x:e.o((e=>c.showPoster=e)),y:e.p({mode:"center",closeable:!0,closeIconColor:"#FFFFFF","safe-area-inset-bottom":!0,customStyle:{background:"none"},modelValue:c.showPoster})})}}});wx.createComponent(r);
