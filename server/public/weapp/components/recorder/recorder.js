"use strict";const e=require("../../common/vendor.js"),s=require("../../api/chat.js"),u=require("../../hooks/useRecorder.js");if(require("../../utils/request/index.js"),require("../../utils/request/http.js"),require("../../enums/requestEnums.js"),require("../../utils/request/cancel.js"),require("../../stores/user.js"),require("../../api/user.js"),require("../../enums/constantEnums.js"),require("../../mixins/share.js"),require("../../api/task.js"),require("../../utils/util.js"),require("../../stores/navigationBarTitle.js"),require("../../router/index.js"),require("../../utils/cache.js"),require("../../stores/app.js"),require("../../api/app.js"),require("../../utils/auth.js"),require("../../config/index.js"),require("../../lib/fft.js"),!Array){(e.resolveComponent("u-input")+e.resolveComponent("u-loading")+e.resolveComponent("u-icon")+e.resolveComponent("loading")+e.resolveComponent("u-popup"))()}Math||((()=>"../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../uni_modules/vk-uview-ui/components/u-loading/u-loading.js")+(()=>"../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../loading/loading.js")+(()=>"../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js"))();const o=e.defineComponent({options:{styleIsolation:"shared"},__name:"recorder",props:{show:{type:Boolean}},emits:["update:show","success"],setup(o,{expose:r,emit:t}){const i=o,a=e.computed({get:()=>i.show,set(e){t("update:show",e)}}),n=e.ref(""),l=e.ref(!1),{start:p,isRecording:c,stop:d,authorize:m,close:v}=u.useRecorder({async onstop(u){if(u.duration<1e3)e.index.$u.toast("说话时间太短");else{l.value=!0;try{const e=await s.audioTransfer(u.tempFilePath,{type:2});n.value+=e.text}finally{l.value=!1}}}}),f=async()=>{if(!c.value&&!l.value)try{await p()}catch(s){e.index.$u.toast(s)}},j=()=>{c.value&&d()};return e.watch(a,(e=>{e?n.value="":j()})),r({authorize:m,startRecord:f,stopRecord:j,closeRecord:v}),(s,u)=>e.e({a:n.value||!l.value&&!e.unref(c),b:e.o((e=>n.value=e)),c:e.p({type:"textarea",placeholder:"请输入您的问题",maxlength:"-1","cursor-spacing":120,"auto-height":!0,"confirm-type":"send",fixed:!0,modelValue:n.value}),d:!n.value&&e.unref(c)},!n.value&&e.unref(c)?{e:e.f(10,((e,s,u)=>({a:e,b:s/10+"s"})))}:{},{f:l.value},l.value?{g:e.p({mode:"flower",color:"#fff",size:40})}:{},{h:l.value},l.value?{}:{i:e.t(e.unref(c)?"松开手指，转换文字":"点击气泡可编辑文字")},{j:e.p({name:"close",size:32}),k:e.o((e=>a.value=!1)),l:e.p({name:"checkmark",size:34}),m:e.o((e=>t("success",n.value))),n:!e.unref(c)},e.unref(c)?{}:{o:e.p({name:"mic",size:60})},{p:e.o(f),q:e.o(j),r:e.o(j),s:e.o((s=>e.isRef(a)?a.value=s:null)),t:e.p({mode:"bottom","safe-area-inset-bottom":!0,mask:!1,height:"100%","custom-style":{background:"linear-gradient(180deg,rgba(18,19,23,.08),rgba(18,19,23,.98) 96%)"},modelValue:e.unref(a)})})}}),r=e._export_sfc(o,[["__scopeId","data-v-b506473a"]]);wx.createComponent(r);
