"use strict";const e=require("../../../common/vendor.js"),o=require("../../../api/app.js"),r=require("../../../api/user.js"),s=require("../../../enums/appEnums.js"),t=require("../../../api/account.js"),u=require("../../../stores/app.js");if(require("../../../utils/request/index.js"),require("../../../utils/request/http.js"),require("../../../enums/requestEnums.js"),require("../../../utils/request/cancel.js"),require("../../../stores/user.js"),require("../../../enums/constantEnums.js"),require("../../../mixins/share.js"),require("../../../api/task.js"),require("../../../utils/util.js"),require("../../../stores/navigationBarTitle.js"),require("../../../router/index.js"),require("../../../utils/cache.js"),require("../../../utils/auth.js"),require("../../../config/index.js"),require("../../../utils/client.js"),!Array){(e.resolveComponent("u-tabs")+e.resolveComponent("u-input")+e.resolveComponent("u-form-item")+e.resolveComponent("u-verification-code")+e.resolveComponent("u-form")+e.resolveComponent("u-button"))()}Math||((()=>"../../../uni_modules/vk-uview-ui/components/u-tabs/u-tabs.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-form-item/u-form-item.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-verification-code/u-verification-code.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-form/u-form.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-button/u-button.js"))();const i=e.defineComponent({__name:"forget_pwd",setup(i){const a=[{name:"手机号",type:"2"},{name:"邮箱",type:"3"}],n=e.ref(0),l=e.computed((()=>{var e;return(null==(e=d.getLoginConfig)?void 0:e.login_way)||[]})),m=e.computed((()=>{const e=a.filter((e=>l.value.includes(e.type)));return e.length&&(v.scene=e[0].type),e})),d=u.useAppStore(),p=e.shallowRef(),c=e.ref(""),v=e.reactive({email:"",mobile:"",password:"",scene:"2",code:"",password_confirm:""}),f=e.computed((()=>e.index.$u.test.mobile(v.mobile))),b=e.computed((()=>e.index.$u.test.email(v.email))),j=e.computed((()=>"2"==v.scene)),w=e.computed((()=>"3"==v.scene)),q=e=>{n.value=e,v.scene=a[e].type,1==e?v.mobile="":v.email=""},h=e=>{c.value=e},x=async()=>{var o,r;if(null==(o=p.value)?void 0:o.canGetCode)try{j.value?await g():await y(),e.index.$u.toast("发送成功"),null==(r=p.value)||r.start()}catch(s){console.log("发送验证码失败=>",s)}},y=async()=>(console.log(b.value),v.email?b.value?void(await t.sendEmailCode({scene:s.SMSEnum.FIND_PASSWORD,email:v.email})):(e.index.$u.toast("请输入正确的邮箱地址"),Promise.reject()):(e.index.$u.toast("请输入邮箱"),Promise.reject())),g=async()=>v.mobile?b.value?(e.index.$u.toast("请输入正确的手机号"),Promise.reject()):void(await o.smsSend({scene:s.SMSEnum.FIND_PASSWORD,mobile:v.mobile})):(e.index.$u.toast("请输入手机号"),Promise.reject()),_=e.useRouter(),$=async()=>!v.mobile&&j.value?e.index.$u.toast("请输入手机号码"):!v.email&&w.value?e.index.$u.toast("请输入邮箱"):v.password?v.password_confirm?v.password!=v.password_confirm?e.index.$u.toast("两次输入的密码不一致"):(await r.forgotPassword(v),void setTimeout((()=>{_.navigateBack()}),1500)):e.index.$u.toast("请输入确认密码"):e.index.$u.toast("请输入密码");return e.onLoad((({type:e})=>{v.scene=e,3==e&&l.value.includes("2")&&(n.value=1)})),(o,r)=>({a:o.$theme.navColor,b:o.$theme.navBgColor,c:o.$theme.pageStyle,d:e.o(q),e:e.o((e=>n.value=e)),f:e.p({list:e.unref(m),"is-scroll":!1,"active-color":o.$theme.primaryColor,modelValue:n.value}),g:e.o((e=>v.mobile=e)),h:e.p({border:!1,placeholder:"请输入手机号码",modelValue:v.mobile}),i:e.unref(j),j:e.p({label:"手机号",borderBottom:!0}),k:e.o((e=>v.email=e)),l:e.p({border:!1,placeholder:"请输入邮箱账号",modelValue:v.email}),m:e.unref(w),n:e.p({label:"邮箱",borderBottom:!0}),o:e.o((e=>v.code=e)),p:e.p({placeholder:"请输入验证码",border:!1,modelValue:v.code}),q:e.sr(p,"e49f8e00-8,e49f8e00-6",{k:"uCodeRef"}),r:e.o(h),s:e.p({seconds:60,"change-text":"x秒"}),t:e.t(c.value),v:e.unref(f)&&e.unref(j)||e.unref(b)&&e.unref(w)?1:"",w:e.o(x),x:e.p({label:"验证码",borderBottom:!0}),y:e.o((e=>v.password=e)),z:e.p({type:"password",placeholder:"6-20位数字+字母或符号组合",border:!1,modelValue:v.password}),A:e.p({label:"新密码",borderBottom:!0}),B:e.o((e=>v.password_confirm=e)),C:e.p({type:"password",placeholder:"再次输入新密码",border:!1,modelValue:v.password_confirm}),D:e.p({label:"确认密码",borderBottom:!0}),E:e.p({borderBottom:!0,"label-width":150}),F:e.o($),G:e.p({type:"primary",shape:"circle"})})}});wx.createPage(i);
