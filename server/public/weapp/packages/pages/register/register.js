"use strict";const e=require("../../../common/vendor.js"),o=require("../../../api/account.js"),r=require("../../../stores/app.js"),u=require("../../../api/app.js"),t=require("../../../enums/appEnums.js"),s=require("../../../hooks/useLockFn.js");if(require("../../../utils/client.js"),require("../../../utils/request/index.js"),require("../../../utils/request/http.js"),require("../../../enums/requestEnums.js"),require("../../../utils/request/cancel.js"),require("../../../stores/user.js"),require("../../../api/user.js"),require("../../../enums/constantEnums.js"),require("../../../mixins/share.js"),require("../../../api/task.js"),require("../../../utils/util.js"),require("../../../stores/navigationBarTitle.js"),require("../../../router/index.js"),require("../../../utils/cache.js"),require("../../../utils/auth.js"),require("../../../config/index.js"),!Array){(e.resolveComponent("u-tabs")+e.resolveComponent("u-input")+e.resolveComponent("u-form-item")+e.resolveComponent("u-verification-code")+e.resolveComponent("u-form")+e.resolveComponent("agreement")+e.resolveComponent("u-button"))()}Math||((()=>"../../../uni_modules/vk-uview-ui/components/u-tabs/u-tabs.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-form-item/u-form-item.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-verification-code/u-verification-code.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-form/u-form.js")+(()=>"../../../components/agreement/agreement.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-button/u-button.js"))();const i=e.defineComponent({__name:"register",setup(i){const n=[{name:"手机号注册",type:"2"},{name:"邮箱注册",type:"3"}],a=e.ref(0),l=e.computed((()=>{var e;return(null==(e=c.getLoginConfig)?void 0:e.login_way)||[]})),m=e.computed((()=>{const e=n.filter((e=>l.value.includes(e.type)));return e.length&&(v.scene=e[0].type),e})),c=r.useAppStore(),d=e.useRouter(),p=e.shallowRef(),v=e.reactive({scene:"2",mobile:"",code:"",email:"",password:"",password_confirm:""}),f=e.shallowRef(),j=e.ref(""),b=e=>{j.value=e},w=e.computed((()=>e.index.$u.test.mobile(v.mobile))),q=e.computed((()=>e.index.$u.test.email(v.email))),g=e.computed((()=>{var e;return 1==(null==(e=c.getLoginConfig)?void 0:e.sms_verify)})),h=e.computed((()=>"2"==v.scene)),y=e.computed((()=>"3"==v.scene)),x=e=>{a.value=e,v.scene=n[e].type,1==e?v.mobile="":v.email=""},C=async()=>{var o,r;if(null==(o=f.value)?void 0:o.canGetCode)try{h.value?await k():await $(),e.index.$u.toast("发送成功"),null==(r=f.value)||r.start()}catch(u){console.log("发送验证码失败=>",u)}},$=async()=>(console.log(q.value),v.email?q.value?void(await o.sendEmailCode({scene:t.SMSEnum.REGISTER,email:v.email})):(e.index.$u.toast("请输入正确的邮箱地址"),Promise.reject()):(e.index.$u.toast("请输入邮箱"),Promise.reject())),k=async()=>v.mobile?q.value?(e.index.$u.toast("请输入正确的手机号"),Promise.reject()):void(await u.smsSend({scene:t.SMSEnum.REGISTER,mobile:v.mobile})):(e.index.$u.toast("请输入手机号"),Promise.reject()),{lockFn:_}=s.useLockFn((async()=>{var r;if(null==(r=p.value)?void 0:r.checkAgreement()){if(!v.mobile&&h.value)return e.index.$u.toast("请输入手机号码");if(!v.email&&y.value)return e.index.$u.toast("请输入邮箱");if(!v.code&&g.value)return e.index.$u.toast("请输入验证码");if(!v.password)return e.index.$u.toast("请输入密码");if(!v.password_confirm)return e.index.$u.toast("请再次输入密码");if(v.password!=v.password_confirm)return e.index.$u.toast("两次输入的密码不一致");await o.register(v),setTimeout((()=>{d.navigateBack()}),1500)}}));return e.onLoad((async({type:e})=>{setTimeout((()=>{v.scene=e,3==e&&l.value.includes("2")&&(a.value=1)}),300)})),(o,r)=>e.e({a:o.$theme.navColor,b:o.$theme.navBgColor,c:o.$theme.pageStyle,d:e.o(x),e:e.o((e=>a.value=e)),f:e.p({list:e.unref(m),"is-scroll":!1,"active-color":o.$theme.primaryColor,modelValue:a.value}),g:e.unref(h)},e.unref(h)?{h:e.o((e=>v.mobile=e)),i:e.p({border:!1,placeholder:"请输入手机号码",modelValue:v.mobile}),j:e.p({label:"手机号",borderBottom:!0})}:{},{k:e.unref(y)},e.unref(y)?{l:e.o((e=>v.email=e)),m:e.p({border:!1,placeholder:"请输入邮箱账号",modelValue:v.email}),n:e.p({label:"邮箱",borderBottom:!0})}:{},{o:e.unref(g)},e.unref(g)?{p:e.o((e=>v.code=e)),q:e.p({placeholder:"请输入验证码",border:!1,modelValue:v.code}),r:e.sr(f,"1c291500-8,1c291500-6",{k:"uCodeRef"}),s:e.o(b),t:e.p({seconds:60,"change-text":"x秒"}),v:e.t(j.value),w:e.unref(w)&&e.unref(h)||e.unref(q)&&e.unref(y)?1:"",x:e.o(C),y:e.p({label:"验证码"})}:{},{z:e.o((e=>v.password=e)),A:e.p({type:"password",placeholder:"请输入字母+数字组合的密码",border:!1,modelValue:v.password}),B:e.p({label:"设置密码",borderBottom:!0}),C:e.o((e=>v.password_confirm=e)),D:e.p({type:"password",placeholder:"再次输入密码",border:!1,modelValue:v.password_confirm}),E:e.p({label:"确认密码",borderBottom:!0}),F:e.p({borderBottom:!0,"label-width":150}),G:e.sr(p,"1c291500-13",{k:"agreementRef"}),H:e.o(e.unref(_)),I:e.p({type:"primary",shape:"circle"})})}});wx.createPage(i);
