"use strict";const e=require("../../../common/vendor.js"),s=require("../../../api/recharge.js"),o=require("../../../api/pay.js"),r=require("../../../enums/appEnums.js"),a=require("../../../hooks/useLockFn.js");if(require("../../../utils/request/index.js"),require("../../../utils/request/http.js"),require("../../../enums/requestEnums.js"),require("../../../utils/request/cancel.js"),require("../../../stores/user.js"),require("../../../api/user.js"),require("../../../enums/constantEnums.js"),require("../../../mixins/share.js"),require("../../../api/task.js"),require("../../../utils/util.js"),require("../../../stores/navigationBarTitle.js"),require("../../../router/index.js"),require("../../../utils/cache.js"),require("../../../stores/app.js"),require("../../../api/app.js"),require("../../../utils/auth.js"),require("../../../config/index.js"),!Array){(e.resolveComponent("u-image")+e.resolveComponent("price")+e.resolveComponent("u-button")+e.resolveComponent("u-empty")+e.resolveComponent("payment")+e.resolveComponent("u-icon")+e.resolveComponent("router-navigate")+e.resolveComponent("u-popup")+e.resolveComponent("page-status")+e.resolveComponent("tabbar"))()}Math||((()=>"../../../uni_modules/vk-uview-ui/components/u-image/u-image.js")+(()=>"../../../components/price/price.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-empty/u-empty.js")+(()=>"../../../components/payment/payment.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../node-modules/uniapp-router-next/components/router-navigate/router-navigate.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js")+(()=>"../../../components/page-status/page-status.js")+(()=>"../../../components/tabbar/tabbar.js"))();const t=e.defineComponent({__name:"recharge",setup(t){const i=e.ref(r.PageStatusEnum.LOADING),n=e.ref({lists:[]}),u=e.index.getSystemInfoSync(),c=e.ref({is_open:1,tips:"立即支付"}),l=e.ref(),p=e.reactive({orderId:"",from:"recharge",showPay:!1,orderAmount:"",showCheck:!1,showPaySuccess:!1}),{isLock:m,lockFn:d}=a.useLockFn((async o=>{e.index.showLoading({mask:!0,title:"请稍后..."});try{const e=await s.recharge({recharge_package_id:o});p.orderId=e.order_id,p.showPay=!0,p.orderAmount=e.order_amount}catch(r){}finally{e.index.hideLoading()}})),v=async()=>{p.showPay=!1,p.showPaySuccess=!0},h=async()=>{var e;n.value=await s.getRechargeConfig(),l.value=(null==(e=n.value.lists.find((e=>e.is_default)))?void 0:e.id)||""},g=async()=>{try{await Promise.all([h()]),i.value=r.PageStatusEnum.NORMAL}catch(e){i.value=r.PageStatusEnum.ERROR}};return e.onShow((async()=>{g(),-1!==u.system.indexOf("iOS")&&await(async()=>{try{c.value=await o.getIosPayConfig(),console.log(c.value),0==c.value.is_open&&e.index.showModal({title:"提示",content:c.value.tips,showCancel:!1,success:()=>e.index.navigateBack()})}catch(s){console.log("获取支付设置错误=>",s)}})()})),e.onLoad((e=>{((null==e?void 0:e.id)||e["amp;id"])&&(e.from||e["amp;from"])&&(p.orderId=(null==e?void 0:e.id)||e["amp;id"],p.from=e.from||e["amp;from"]),(null==e?void 0:e.checkPay)&&(p.showCheck=!0)})),e.onPullDownRefresh((async()=>{try{await g()}catch(s){}e.index.stopPullDownRefresh()})),(s,o)=>{var r,a;return e.e({a:s.$theme.navColor,b:s.$theme.navBgColor,c:s.$theme.pageStyle,d:c.value.is_open},c.value.is_open?e.e({e:n.value.status},n.value.status?e.e({f:null==(r=n.value.lists)?void 0:r.length},(null==(a=n.value.lists)?void 0:a.length)?{g:e.f(n.value.lists,((s,o,r)=>e.e({a:"ae960c00-1-"+r+",ae960c00-0",b:e.p({width:"100%",height:"100%",src:s.image,mode:"aspectFill"}),c:s.tag},s.tag?{d:e.t(s.tag)}:{},{e:"ae960c00-2-"+r+",ae960c00-0",f:e.p({content:s.sell_price,mainSize:"40rpx",minorSize:"28rpx",color:"#FF2C3C",fontWeight:500}),g:e.t(s.name),h:e.t(s.describe),i:e.t(s.number),j:s.is_give&&s.give_number},s.is_give&&s.give_number?{k:e.t(s.give_number)}:{},{l:e.t(s.draw_number),m:s.is_give&&s.give_draw_number},s.is_give&&s.give_draw_number?{n:e.t(s.give_draw_number)}:{},c.value.is_open?{o:e.o((o=>e.unref(d)(s.id)),s.id),p:"ae960c00-3-"+r+",ae960c00-0",q:e.p({"custom-style":{width:"100%",height:"68rpx",fontSize:"28rpx"},type:"primary",shape:"circle"})}:{},{r:s.id,s:e.o((e=>l.value=s.id),s.id)}))),h:c.value.is_open}:{}):{i:e.p({text:"功能未开启"})},{j:e.p({text:"加载出错～"}),k:e.o(v),l:e.o((e=>p.showPay=e)),m:e.o((e=>p.showCheck=e)),n:e.p({"order-id":p.orderId,from:p.from,redirect:"/packages/pages/recharge/recharge","order-amount":p.orderAmount,show:p.showPay,showCheck:p.showCheck}),o:e.p({name:"checkmark-circle-fill",size:"100"}),p:e.o((e=>p.showPaySuccess=!1)),q:e.p({to:"/pages/index/index","nav-type":"reLaunch"}),r:e.o((e=>p.showPaySuccess=e)),s:e.p({"safe-area-inset-bottom":!0,"mask-close-able":!1,"border-radius":"14","z-index":899,round:!0,mode:"center",width:"600",modelValue:p.showPaySuccess}),t:e.p({status:i.value})}):{})}}});wx.createPage(t);
