"use strict";const e=require("../../../../common/vendor.js"),i=require("../../../../api/square.js"),r=require("../../../../stores/user.js"),a=require("../../../../common/assets.js"),o=require("../../../../router/index.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../config/index.js"),require("../../../../api/user.js"),require("../../../../enums/constantEnums.js"),require("../../../../mixins/share.js"),require("../../../../api/task.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../utils/auth.js"),require("../../../../utils/cache.js"),!Array){(e.resolveComponent("u-lazy-load")+e.resolveComponent("u-icon")+e.resolveComponent("u-waterfall")+e.resolveComponent("z-paging"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-lazy-load/u-lazy-load.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-waterfall/u-waterfall.js")+(()=>"../../../../node-modules/z-paging/components/z-paging/z-paging.js"))();const s=e.defineComponent({__name:"lists",props:{cid:{default:0},i:null,index:null,keyword:{default:""}},emits:["click","showPoster"],setup(s,{emit:l}){const u=s,n=r.useUserStore(),t=e.shallowRef(null),c=e.shallowRef(null),d=e.ref(!0),p=e.ref([]),m=e.ref(-1);e.watch((()=>u.keyword),(async()=>{var i;await e.nextTick$1(),u.i==u.index&&(null==(i=c.value)||i.reload())}),{immediate:!1}),e.watch((()=>u.i),(async()=>{var i;u.i==u.index&&d.value&&(d.value=!1,await e.nextTick$1(),null==(i=c.value)||i.reload())}),{immediate:!0});const v=async(e,r)=>{var a;try{const{lists:o}=await i.getDrawSquareLists({category_id:u.cid,keyword:u.keyword,page_no:e,page_size:r});(u.keyword||1==e)&&(null==(a=t.value)||a.clear()),c.value.complete(o)}catch(o){console.log("报错=>",o),c.value.complete(!1)}},b=e=>{-1==m.value||m.value!=e.id?m.value=e.id:(m.value=-1,l("click",e))},g=async r=>{var a,s;if(n.isLogin)try{await i.drawPraise({id:r.id,praise:r.is_praise?0:1}),0===u.cid?(c.value.refresh(),null==(a=t.value)||a.remove(r.id)):null==(s=t.value)||s.modify(r.id,"is_praise",r.is_praise?0:1)}catch(l){console.error(l),e.index.$u.toast(JSON.stringify(l))}else o.router.navigateTo("/pages/login/login")};return(i,r)=>({a:e.w((({leftList:r},o,s)=>({a:e.f(r,((r,o,l)=>e.e({a:"be0438bc-2-"+s+"-"+l+",be0438bc-1",b:e.p({threshold:"0","border-radius":"10",image:(null==r?void 0:r.thumbnail)||(null==r?void 0:r.image),index:o,errorImg:e.unref(a.ErrorIcon),loadingImg:e.unref(a.LoadingIcon)}),c:r.id==m.value},r.id==m.value?{d:e.n(r.is_praise?"praise-entry":"praise-leave"),e:e.o((e=>g(r)),o),f:"be0438bc-3-"+s+"-"+l+",be0438bc-1",g:e.p({name:"photo",color:"#FFFFFF",size:"34rpx"}),h:e.o((e=>i.$emit("showPoster",r)),o)}:{},{i:o,j:e.o((e=>b(r)),o)}))),b:s,c:o})),{name:"left",path:"a",vueId:"be0438bc-1,be0438bc-0"}),b:e.w((({rightList:r},o,s)=>({a:e.f(r,((r,o,l)=>e.e({a:"be0438bc-4-"+s+"-"+l+",be0438bc-1",b:e.p({threshold:"0","border-radius":"10",image:(null==r?void 0:r.thumbnail)||(null==r?void 0:r.image),index:o,errorImg:e.unref(a.ErrorIcon),loadingImg:e.unref(a.LoadingIcon)}),c:r.id==m.value},r.id==m.value?{d:e.n(r.is_praise?"praise-entry":"praise-leave"),e:e.o((e=>g(r)),o),f:"be0438bc-5-"+s+"-"+l+",be0438bc-1",g:e.p({name:"photo",color:"#FFFFFF",size:"34"}),h:e.o((e=>i.$emit("showPoster",r)),o)}:{},{i:o,j:e.o((e=>b(r)),o)}))),b:s,c:o})),{name:"right",path:"b",vueId:"be0438bc-1,be0438bc-0"}),c:e.sr(t,"be0438bc-1,be0438bc-0",{k:"waterfallRef"}),d:e.o((e=>p.value=e)),e:e.p({"add-time":"50",modelValue:p.value}),f:e.sr(c,"be0438bc-0",{k:"paging"}),g:s.i,h:e.o(v),i:e.o((e=>p.value=e)),j:e.p({"auto-show-back-to-top":!0,auto:s.i==s.index,fixed:!1,height:"100%","auto-clean-list-when-reload":!0,"auto-scroll-to-top-when-reload":!1,modelValue:p.value})})}}),l=e._export_sfc(s,[["__scopeId","data-v-be0438bc"]]);wx.createComponent(l);
